import{a0 as A,e as F,i as Y,a1 as G,f as b,h as k,a2 as Z,J as O,K,u as W,r as N,A as H,o as J,U as X,M as m,O as u,R as s,N as r,a3 as I,a4 as w,L as g,a5 as $,a6 as P,$ as v,T as n,S as _,a7 as U,V as M,X as ee,a8 as te,a9 as ae}from"./index-TreL_WJR.js";import{b as le}from"./format-BvkBI9bc.js";import{Q as z}from"./QLinearProgress-CpLcujzc.js";import{Q as se}from"./QPage-BEEUHEA3.js";const ne={...A,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},Q=50,L=2*Q,R=L*Math.PI,re=Math.round(R*1e3)/1e3,oe=F({name:"QCircularProgress",props:{...ne,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:a}){const{proxy:{$q:o}}=Y(),d=G(e),c=b(()=>{const t=(o.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(o.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-t}deg)`:`rotate3d(0, 0, 1, ${t-90}deg)`}}),f=b(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),i=b(()=>L/(1-e.thickness/2)),C=b(()=>`${i.value/2} ${i.value/2} ${i.value} ${i.value}`),S=b(()=>le(e.value,e.min,e.max)),B=b(()=>e.max-e.min),y=b(()=>e.thickness/2*i.value),D=b(()=>{const t=(e.max-S.value)/B.value,l=e.rounded===!0&&S.value<e.max&&t<.25?y.value/2*(1-t/.25):0;return R*t+l});function h({thickness:t,offset:l,color:x,cls:V,rounded:q}){return k("circle",{class:"q-circular-progress__"+V+(x!==void 0?` text-${x}`:""),style:f.value,fill:"transparent",stroke:"currentColor","stroke-width":t,"stroke-dasharray":re,"stroke-dashoffset":l,"stroke-linecap":q,cx:i.value,cy:i.value,r:Q})}return()=>{const t=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&t.push(k("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:Q-y.value/2,cx:i.value,cy:i.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&t.push(h({cls:"track",thickness:y.value,offset:0,color:e.trackColor})),t.push(h({cls:"circle",thickness:y.value,offset:D.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const l=[k("svg",{class:"q-circular-progress__svg",style:c.value,viewBox:C.value,"aria-hidden":"true"},t)];return e.showValue===!0&&l.push(k("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},a.default!==void 0?a.default():[k("div",S.value)])),k("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:d.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:S.value},Z(a.internal,l))}}}),ie=["top","middle","bottom"],T=F({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>ie.includes(e)}},setup(e,{slots:a}){const o=b(()=>e.align!==void 0?{verticalAlign:e.align}:null),d=b(()=>{const c=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(c!==void 0?` text-${c}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>k("div",{class:d.value,style:o.value,role:"status","aria-label":e.label},O(a.default,e.label!==void 0?[e.label]:[]))}}),de=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],ue=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],ce=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],me=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],E=(e,a,o)=>{let d=e;return typeof a=="string"||Array.isArray(a)?d=e.toLocaleString(a,o):(a===!0||o!==void 0)&&(d=e.toLocaleString(void 0,o)),d},j=e=>{if(typeof e=="number")return Math.log10(e);const a=e.toString(10);return a.length+Math.log10("0."+a.slice(0,15))},ve=e=>typeof e=="number"?Math.log(e):j(e)*Math.log(10),fe=(e,a)=>{if(typeof e=="number")return e/a;const o=e/BigInt(a),d=e%BigInt(a);return Number(o)+Number(d)/a};function p(e,a){if(typeof e!="bigint"&&!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);a={bits:!1,binary:!1,space:!0,...a};const o=a.bits?a.binary?me:ce:a.binary?ue:de,d=a.space?" ":"";if(a.signed&&(typeof e=="number"?e===0:e===0n))return` 0${d}${o[0]}`;const c=e<0,f=c?"-":a.signed?"+":"";c&&(e=-e);let i;if(a.minimumFractionDigits!==void 0&&(i={minimumFractionDigits:a.minimumFractionDigits}),a.maximumFractionDigits!==void 0&&(i={maximumFractionDigits:a.maximumFractionDigits,...i}),e<1){const y=E(e,a.locale,i);return f+y+d+o[0]}const C=Math.min(Math.floor(a.binary?ve(e)/Math.log(1024):j(e)/3),o.length-1);if(e=fe(e,(a.binary?1024:1e3)**C),!i){const y=Math.max(3,Number.parseInt(e,10).toString().length);e=e.toPrecision(y)}const S=E(Number(e),a.locale,i),B=o[C];return f+S+d+B}const ge={class:"row"},be={class:"col col-12 col-md-8"},ye={class:"row"},he={class:"text-overline"},xe={class:"absolute-full flex flex-center"},Se={class:"absolute-full flex justify-end"},pe={class:"absolute-full flex flex-center"},ke={class:"absolute-full flex justify-end"},Ce={key:0},_e={key:1},Be={key:2},we={key:0},Pe=K({__name:"ServerStatus",setup(e){const a=W(),o=N(void 0),d=N(-1),c=N(!1),f=N("/tmp/typesense-data-snapshot");function i(h){return typeof h=="object"}function C(){f.value=`/tmp/typesense-data-snapshot-${new Date().toISOString().replace(/:\d{2}\.\d{3}Z$/,"")}`,c.value=!0}function S(){c.value=!1,f.value="/tmp/typesense-data-snapshot"}function B(){y.value&&(a.createSnapshot(f.value),c.value=!1)}const y=b(()=>f.value&&f.value.length>0);H(()=>{o.value=window.setInterval(()=>{a.refreshServerStatus()},2e3)}),J(()=>{window.clearInterval(o.value)});const D=b(()=>Object.entries(a.data.metrics).filter(([h])=>h.includes("cpu")).map(([h,t])=>{let l=0;const x=h.split("_");return x.length>1&&x[1]&&(l=parseInt(x[1].replace("cpu",""))||0),{node:l,value:parseFloat(t)}}).sort((h,t)=>h.node-t.node));return(h,t)=>(m(),X(se,{padding:""},{default:u(()=>[s("div",ge,[s("div",be,[r(I,{flat:"",bordered:"",class:"q-mb-md"},{default:u(()=>[r(w,null,{default:u(()=>[t[5]||(t[5]=s("div",{class:"text-h5"},"System",-1)),t[6]||(t[6]=s("div",{class:"text-subtitle1 q-pt-md"},"CPU",-1)),s("div",ye,[(m(!0),g($,null,P(D.value,l=>(m(),g("div",{key:l.node,class:"column flex-center flex-wrap q-ma-md"},[s("span",he,"CPU "+v(l.node),1),r(oe,{"show-value":"",value:l.value,size:"50px",color:"accent","track-color":"grey-3"},null,8,["value"])]))),128))]),t[7]||(t[7]=s("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),r(z,{size:"25px",value:parseInt(n(a).data.metrics.system_memory_used_bytes,10)/parseInt(n(a).data.metrics.system_memory_total_bytes,10),color:"accent"},{default:u(()=>[s("div",xe,[r(T,{color:"white","text-color":"accent",label:n(p)(parseInt(n(a).data.metrics.system_memory_used_bytes,10))},null,8,["label"])]),s("div",Se,[r(T,{color:"white","text-color":"accent",label:n(p)(parseInt(n(a).data.metrics.system_memory_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),t[8]||(t[8]=s("div",{class:"text-subtitle1 q-pt-md"},"Disk",-1)),r(z,{size:"25px",value:parseInt(n(a).data.metrics.system_disk_used_bytes,10)/parseInt(n(a).data.metrics.system_disk_total_bytes,10),color:"accent"},{default:u(()=>[s("div",pe,[r(T,{color:"white","text-color":"accent",label:n(p)(parseInt(n(a).data.metrics.system_disk_used_bytes,10))},null,8,["label"])]),s("div",ke,[r(T,{color:"white","text-color":"accent",label:n(p)(parseInt(n(a).data.metrics.system_disk_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),t[9]||(t[9]=s("div",{class:"text-subtitle1 q-pt-md"},"System Network",-1)),s("div",null," Received: "+v(n(p)(parseInt(n(a).data.metrics.system_network_received_bytes,10)))+" Sent: "+v(n(p)(parseInt(n(a).data.metrics.system_network_sent_bytes,10))),1)]),_:1})]),_:1}),r(I,{flat:"",bordered:"",class:"q-mb-md"},{default:u(()=>[r(w,null,{default:u(()=>[t[10]||(t[10]=s("div",{class:"text-h5 q-mb-md"},"Operations",-1)),t[11]||(t[11]=s("div",{class:"text-subtitle1 q-pt-md"},"Cache",-1)),t[12]||(t[12]=s("p",null," Responses of search requests that are sent with use_cache parameter are cached in a LRU cache. ",-1)),r(_,{label:"Clear Search Cache",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:n(a).clearCache},null,8,["onClick"]),t[13]||(t[13]=s("div",{class:"text-subtitle1 q-pt-md"},"Slow Request Log",-1)),t[14]||(t[14]=s("p",null,"Slow requests are logged to the primary log file, with the prefix SLOW REQUEST",-1)),r(U,{modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=l=>d.value=l),modelModifiers:{number:!0},outlined:"",label:"Threshold (ms)",type:"number",hint:"Enable logging of requests that take over a defined threshold of time. (-1 to disable)"},{after:u(()=>[r(_,{unelevated:"",label:"set",color:"accent",size:"md",padding:"sm lg",onClick:t[0]||(t[0]=l=>n(a).slowQueryThreshold(d.value))})]),_:1},8,["modelValue"]),t[15]||(t[15]=s("div",{class:"text-subtitle1 q-pt-md"},"Compacting the on-disk database",-1)),t[16]||(t[16]=s("p",null,"Recommended to run it during off-peak hours.",-1)),r(_,{label:"Compact Database",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:n(a).operationCompactDB},null,8,["onClick"]),t[17]||(t[17]=s("div",{class:"text-subtitle1 q-pt-md"},"Create Snapshot",-1)),t[18]||(t[18]=s("p",null," Creates a point-in-time snapshot of the node's state and data for backup purposes. ",-1)),r(_,{label:"Create Snapshot",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:t[2]||(t[2]=l=>C())})]),_:1})]),_:1})]),r(I,{flat:"",bordered:"",class:"col-12 col-md-3 offset-md-1 q-mb-md"},{default:u(()=>[r(w,null,{default:u(()=>[t[19]||(t[19]=s("div",{class:"text-h5"},"Typesense",-1)),t[20]||(t[20]=s("div",{class:"text-subtitle1 q-pt-md"},"Node",-1)),s("div",null,"Protocol: "+v(n(a).loginData?.node.protocol),1),s("div",null,"Host: "+v(n(a).loginData?.node.host),1),s("div",null,"Port: "+v(n(a).loginData?.node.port),1),n(a).data.debug.version?(m(),g("div",Ce,"Version: "+v(n(a).data.debug.version),1)):M("",!0),Object.hasOwnProperty.call(n(a).data.debug,"state")?(m(),g("div",_e," Role: "+v(n(a).data.debug.state===1?"Leader":"Follower"),1)):M("",!0),t[21]||(t[21]=s("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),(m(!0),g($,null,P(Object.keys(n(a).data.metrics).filter(l=>l.includes("typesense")),l=>(m(),g("div",{key:l},v(l.split("_")[2])+" : "+v(l.includes("bytes")?n(p)(parseInt(n(a).data.metrics[l],10)):n(a).data.metrics[l]),1))),128)),t[22]||(t[22]=s("div",{class:"text-subtitle1 q-pt-md"},"Stats",-1)),n(a).data.features.stats?M("",!0):(m(),g("div",Be,"Stats are not enabled on this node.")),(m(!0),g($,null,P(n(a).data.stats,(l,x)=>(m(),g("div",{key:x},[i(l)?(m(),g("div",we,[ee(v(x)+" ",1),(m(!0),g($,null,P(l,(V,q)=>(m(),g("div",{key:q},v(q)+" : "+v(V),1))),128))])):M("",!0)]))),128))]),_:1})]),_:1})]),r(te,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=l=>c.value=l),persistent:""},{default:u(()=>[r(I,{style:{"min-width":"400px"}},{default:u(()=>[r(w,null,{default:u(()=>[...t[23]||(t[23]=[s("div",{class:"text-h6"},"Create Snapshot",-1),s("div",{class:"text-subtitle2 text-grey-7 q-mt-sm"}," Enter the directory path where the snapshot should be saved on the server. ",-1)])]),_:1}),r(w,{class:"q-pt-none"},{default:u(()=>[r(U,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=l=>f.value=l),outlined:"",label:"Snapshot Path",hint:"Example: /tmp/typesense-data-snapshot",rules:[l=>l&&l.length>0||"Snapshot path is required"]},null,8,["modelValue","rules"])]),_:1}),r(ae,{align:"right",class:"text-primary"},{default:u(()=>[r(_,{flat:"",label:"Cancel",onClick:S}),r(_,{flat:"",label:"Create Snapshot",color:"accent",disable:!y.value,onClick:B},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Pe as default};
