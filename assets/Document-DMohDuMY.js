import{K as V,u as N,H as D,f as Q,w as C,U as p,M as n,O as a,R as l,N as d,V as _,X as m,W as S,$ as u,T as g,S as y,L as c,a5 as j,a6 as T,ac as B}from"./index-CZ_mhFwg.js";import{Q as v}from"./QBanner-yzLMqijD.js";import{a as O}from"./QSelect-BDS__IRR.js";import{Q as U}from"./QPage-D5LXElzy.js";import{M as A}from"./MonacoEditor-CoHmDVmK.js";import{u as F}from"./use-quasar-DiWuToDk.js";import"./QChip-DSLa00xN.js";import"./QItem-DHw9O_07.js";import"./QResizeObserver-C0P7sC1f.js";const J={class:"row justify-between q-mb-md"},$={class:"text-h5"},z={key:0},I={class:"row q-mb-md bg-primary text-white justify-between"},P={class:"row col-auto"},q={key:0},M={key:1},te=V({__name:"Document",setup(L){const i=F(),r=N(),e=D({jsonError:null,documents:[],results:[],action:"upsert"}),x=["create","upsert","update"],E={create:"Create a new document. Fails if id exists.",upsert:"Create a new document or update an existing document.",update:"Update an existing document. Partial document allowed."},f=Q({get:()=>JSON.stringify(e.documents,null,2),set:s=>{try{e.documents=JSON.parse(s),e.jsonError=null}catch(t){e.jsonError=t.message}}});C(()=>r.currentCollection,()=>{e.documents=[],w()},{immediate:!0}),C(()=>r.documentsToEdit,()=>{r.documentsToEdit&&r.documentsToEdit.length>0&&(e.documents=r.documentsToEdit||[],e.action="upsert",r.setDocumentsToEdit([]))},{immediate:!0});async function k(){e.results=[];try{i.loading.show({message:"Uploading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});let s=await r.api?.importFile(r.currentCollection?.name,e.action);Array.isArray(s)||(s=[{error:s}]),e.results=s}catch(s){e.results=[{error:s.message}]}i.loading.hide()}async function h(){e.results=[];try{i.loading.show({message:"Uploading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),e.results=await r.importDocuments({action:e.action,documents:JSON.parse(JSON.stringify(e.documents))})}catch(s){e.results=[{error:s.message}]}i.loading.hide()}function w(){let s={};r.currentCollection&&r.currentCollection.fields&&(s=r.currentCollection.fields.reduce((t,o)=>(t[o.name]=o.type.includes("[]")?[]:o.type.includes("string")?"":o.type.includes("bool")?!1:0,t),{})),e.documents.push(s)}return(s,t)=>(n(),p(U,{padding:"",class:"column"},{default:a(()=>[l("div",J,[l("div",$,[d(S,{size:"md",name:"sym_s_library_add"}),m(" Add Documents to "+u(g(r).currentCollection?.name),1)]),d(y,{unelevated:"",disable:!g(i).platform.is.electron,icon:"sym_s_attach_file",onClick:t[0]||(t[0]=o=>k())},{default:a(()=>[t[5]||(t[5]=m(" Import from file ",-1)),g(i).platform.is.electron?_("",!0):(n(),c("span",z," (only desktop version)"))]),_:1},8,["disable"])]),d(A,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),style:{"min-height":"200px"}},null,8,["modelValue"]),e.jsonError?(n(),p(v,{key:0,"inline-actions":"",class:"text-white bg-red"},{default:a(()=>[m(" Invalid Format: "+u(e.jsonError),1)]),_:1})):_("",!0),l("div",I,[d(y,{unelevated:"",size:"md",padding:"sm lg",color:"primary",onClick:t[2]||(t[2]=o=>w())},{default:a(()=>[...t[6]||(t[6]=[m("Add empty Document",-1)])]),_:1}),l("div",P,[d(O,{modelValue:e.action,"onUpdate:modelValue":t[3]||(t[3]=o=>e.action=o),dark:"","bottom-slots":"",label:"Action mode",filled:"",style:{width:"300px"},options:x},{hint:a(()=>[l("div",null,u(E[e.action]),1)]),_:1},8,["modelValue"]),d(y,{unelevated:"",size:"md",padding:"sm xl",color:"primary",disable:!!e.jsonError,onClick:t[4]||(t[4]=o=>h())},{default:a(()=>[...t[7]||(t[7]=[m("Import",-1)])]),_:1},8,["disable"])])]),l("div",null,[(n(!0),c(j,null,T(e.results,(o,b)=>(n(),p(v,{key:b,class:B(["text-white",{"bg-green":o.success,"bg-red":o.error}])},{default:a(()=>[m(u(b)+": ",1),o.success?(n(),c("span",q,u(o.success),1)):(n(),c("span",M,u(o.error),1))]),_:2},1032,["class"]))),128))])]),_:1}))}});export{te as default};
