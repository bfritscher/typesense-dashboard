import{a0 as Y,e as F,i as Z,a1 as G,f as y,h as B,a2 as O,J as K,K as H,u as J,r as N,A as X,o as W,U as ee,M as m,O as d,R as s,N as o,a3 as I,a4 as q,L as b,a5 as M,a6 as P,$ as f,T as n,S as _,a7 as E,V as T,X as te,a8 as ae,a9 as le}from"./index-DnHRCA39.js";import{b as se}from"./format-BvkBI9bc.js";import{Q as U}from"./QLinearProgress-C9DFsjuP.js";import{Q as ne}from"./QPage-C9y48WQW.js";const oe={...Y,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},D=50,R=2*D,A=R*Math.PI,re=Math.round(A*1e3)/1e3,ie=F({name:"QCircularProgress",props:{...oe,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:t}){const{proxy:{$q:r}}=Z(),i=G(e),v=y(()=>{const a=(r.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(r.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-a}deg)`:`rotate3d(0, 0, 1, ${a-90}deg)`}}),g=y(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),u=y(()=>R/(1-e.thickness/2)),k=y(()=>`${u.value/2} ${u.value/2} ${u.value} ${u.value}`),h=y(()=>se(e.value,e.min,e.max)),p=y(()=>e.max-e.min),S=y(()=>e.thickness/2*u.value),w=y(()=>{const a=(e.max-h.value)/p.value,l=e.rounded===!0&&h.value<e.max&&a<.25?S.value/2*(1-a/.25):0;return A*a+l});function c({thickness:a,offset:l,color:x,cls:Q,rounded:$}){return B("circle",{class:"q-circular-progress__"+Q+(x!==void 0?` text-${x}`:""),style:g.value,fill:"transparent",stroke:"currentColor","stroke-width":a,"stroke-dasharray":re,"stroke-dashoffset":l,"stroke-linecap":$,cx:u.value,cy:u.value,r:D})}return()=>{const a=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&a.push(B("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:D-S.value/2,cx:u.value,cy:u.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&a.push(c({cls:"track",thickness:S.value,offset:0,color:e.trackColor})),a.push(c({cls:"circle",thickness:S.value,offset:w.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const l=[B("svg",{class:"q-circular-progress__svg",style:v.value,viewBox:k.value,"aria-hidden":"true"},a)];return e.showValue===!0&&l.push(B("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},t.default!==void 0?t.default():[B("div",h.value)])),B("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:i.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:h.value},O(t.internal,l))}}}),de=["top","middle","bottom"],V=F({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>de.includes(e)}},setup(e,{slots:t}){const r=y(()=>e.align!==void 0?{verticalAlign:e.align}:null),i=y(()=>{const v=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(v!==void 0?` text-${v}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>B("div",{class:i.value,style:r.value,role:"status","aria-label":e.label},K(t.default,e.label!==void 0?[e.label]:[]))}}),ue=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],ce=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],me=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],fe=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],z=(e,t,r)=>{let i=e;return typeof t=="string"||Array.isArray(t)?i=e.toLocaleString(t,r):(t===!0||r!==void 0)&&(i=e.toLocaleString(void 0,r)),i},j=e=>{if(typeof e=="number")return Math.log10(e);const t=e.toString(10);return t.length+Math.log10(`0.${t.slice(0,15)}`)},ve=e=>typeof e=="number"?Math.log(e):j(e)*Math.log(10),ge=(e,t)=>{if(typeof e=="number")return e/t;const r=e/BigInt(t),i=e%BigInt(t);return Number(r)+Number(i)/t},L=(e,t)=>{if(t===void 0)return e;if(typeof t!="number"||!Number.isSafeInteger(t)||t<0)throw new TypeError(`Expected fixedWidth to be a non-negative integer, got ${typeof t}: ${t}`);return t===0?e:e.length<t?e.padStart(t," "):e},be=e=>{const{minimumFractionDigits:t,maximumFractionDigits:r}=e;if(!(t===void 0&&r===void 0))return{...t!==void 0&&{minimumFractionDigits:t},...r!==void 0&&{maximumFractionDigits:r},roundingMode:"trunc"}};function C(e,t){if(typeof e!="bigint"&&!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,nonBreakingSpace:!1,...t};const r=t.bits?t.binary?fe:me:t.binary?ce:ue,i=t.space?t.nonBreakingSpace?"Â ":" ":"",v=typeof e=="number"?e===0:e===0n;if(t.signed&&v){const p=` 0${i}${r[0]}`;return L(p,t.fixedWidth)}const g=e<0,u=g?"-":t.signed?"+":"";g&&(e=-e);const k=be(t);let h;if(e<1){const p=z(e,t.locale,k);h=u+p+i+r[0]}else{const p=Math.min(Math.floor(t.binary?ve(e)/Math.log(1024):j(e)/3),r.length-1);if(e=ge(e,(t.binary?1024:1e3)**p),!k){const c=Math.max(3,Math.floor(e).toString().length);e=e.toPrecision(c)}const S=z(Number(e),t.locale,k),w=r[p];h=u+S+i+w}return L(h,t.fixedWidth)}const ye={class:"row"},he={class:"col col-12 col-md-8"},pe={class:"row"},Se={class:"text-overline"},xe={class:"absolute-full flex flex-center"},ke={class:"absolute-full flex justify-end"},Ce={class:"absolute-full flex flex-center"},Be={class:"absolute-full flex justify-end"},_e={key:0},we={key:1},qe={key:2},$e={key:0},Te=H({__name:"ServerStatus",setup(e){const t=J(),r=N(void 0),i=N(-1),v=N(!1),g=N("/tmp/typesense-data-snapshot");function u(c){return typeof c=="object"}function k(){g.value=`/tmp/typesense-data-snapshot-${new Date().toISOString().replace(/:\d{2}\.\d{3}Z$/,"")}`,v.value=!0}function h(){v.value=!1,g.value="/tmp/typesense-data-snapshot"}function p(){S.value&&(t.createSnapshot(g.value),v.value=!1)}const S=y(()=>g.value&&g.value.length>0);X(()=>{r.value=window.setInterval(()=>{t.refreshServerStatus()},2e3)}),W(()=>{window.clearInterval(r.value)});const w=y(()=>Object.entries(t.data.metrics).filter(([c])=>c.includes("cpu")).map(([c,a])=>{let l=0;const x=c.split("_");return x.length>1&&x[1]&&(l=parseInt(x[1].replace("cpu",""))||0),{node:l,value:parseFloat(a)}}).sort((c,a)=>c.node-a.node));return(c,a)=>(m(),ee(ne,{padding:""},{default:d(()=>[s("div",ye,[s("div",he,[o(I,{flat:"",bordered:"",class:"q-mb-md"},{default:d(()=>[o(q,null,{default:d(()=>[a[5]||(a[5]=s("div",{class:"text-h5"},"System",-1)),a[6]||(a[6]=s("div",{class:"text-subtitle1 q-pt-md"},"CPU",-1)),s("div",pe,[(m(!0),b(M,null,P(w.value,l=>(m(),b("div",{key:l.node,class:"column flex-center flex-wrap q-ma-md"},[s("span",Se,"CPU "+f(l.node),1),o(ie,{"show-value":"",value:l.value,size:"50px",color:"accent","track-color":"grey-3"},null,8,["value"])]))),128))]),a[7]||(a[7]=s("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),o(U,{size:"25px",value:parseInt(n(t).data.metrics.system_memory_used_bytes,10)/parseInt(n(t).data.metrics.system_memory_total_bytes,10),color:"accent"},{default:d(()=>[s("div",xe,[o(V,{color:"white","text-color":"accent",label:n(C)(parseInt(n(t).data.metrics.system_memory_used_bytes,10))},null,8,["label"])]),s("div",ke,[o(V,{color:"white","text-color":"accent",label:n(C)(parseInt(n(t).data.metrics.system_memory_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),a[8]||(a[8]=s("div",{class:"text-subtitle1 q-pt-md"},"Disk",-1)),o(U,{size:"25px",value:parseInt(n(t).data.metrics.system_disk_used_bytes,10)/parseInt(n(t).data.metrics.system_disk_total_bytes,10),color:"accent"},{default:d(()=>[s("div",Ce,[o(V,{color:"white","text-color":"accent",label:n(C)(parseInt(n(t).data.metrics.system_disk_used_bytes,10))},null,8,["label"])]),s("div",Be,[o(V,{color:"white","text-color":"accent",label:n(C)(parseInt(n(t).data.metrics.system_disk_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),a[9]||(a[9]=s("div",{class:"text-subtitle1 q-pt-md"},"System Network",-1)),s("div",null," Received: "+f(n(C)(parseInt(n(t).data.metrics.system_network_received_bytes,10)))+" Sent: "+f(n(C)(parseInt(n(t).data.metrics.system_network_sent_bytes,10))),1)]),_:1})]),_:1}),o(I,{flat:"",bordered:"",class:"q-mb-md"},{default:d(()=>[o(q,null,{default:d(()=>[a[10]||(a[10]=s("div",{class:"text-h5 q-mb-md"},"Operations",-1)),a[11]||(a[11]=s("div",{class:"text-subtitle1 q-pt-md"},"Cache",-1)),a[12]||(a[12]=s("p",null," Responses of search requests that are sent with use_cache parameter are cached in a LRU cache. ",-1)),o(_,{label:"Clear Search Cache",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:n(t).clearCache},null,8,["onClick"]),a[13]||(a[13]=s("div",{class:"text-subtitle1 q-pt-md"},"Slow Request Log",-1)),a[14]||(a[14]=s("p",null,"Slow requests are logged to the primary log file, with the prefix SLOW REQUEST",-1)),o(E,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=l=>i.value=l),modelModifiers:{number:!0},outlined:"",label:"Threshold (ms)",type:"number",hint:"Enable logging of requests that take over a defined threshold of time. (-1 to disable)"},{after:d(()=>[o(_,{unelevated:"",label:"set",color:"accent",size:"md",padding:"sm lg",onClick:a[0]||(a[0]=l=>n(t).slowQueryThreshold(i.value))})]),_:1},8,["modelValue"]),a[15]||(a[15]=s("div",{class:"text-subtitle1 q-pt-md"},"Compacting the on-disk database",-1)),a[16]||(a[16]=s("p",null,"Recommended to run it during off-peak hours.",-1)),o(_,{label:"Compact Database",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:n(t).operationCompactDB},null,8,["onClick"]),a[17]||(a[17]=s("div",{class:"text-subtitle1 q-pt-md"},"Create Snapshot",-1)),a[18]||(a[18]=s("p",null," Creates a point-in-time snapshot of the node's state and data for backup purposes. ",-1)),o(_,{label:"Create Snapshot",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:a[2]||(a[2]=l=>k())})]),_:1})]),_:1})]),o(I,{flat:"",bordered:"",class:"col-12 col-md-3 offset-md-1 q-mb-md"},{default:d(()=>[o(q,null,{default:d(()=>[a[19]||(a[19]=s("div",{class:"text-h5"},"Typesense",-1)),a[20]||(a[20]=s("div",{class:"text-subtitle1 q-pt-md"},"Node",-1)),s("div",null,"Protocol: "+f(n(t).loginData?.node.protocol),1),s("div",null,"Host: "+f(n(t).loginData?.node.host),1),s("div",null,"Port: "+f(n(t).loginData?.node.port),1),n(t).data.debug.version?(m(),b("div",_e,"Version: "+f(n(t).data.debug.version),1)):T("",!0),Object.hasOwnProperty.call(n(t).data.debug,"state")?(m(),b("div",we," Role: "+f(n(t).data.debug.state===1?"Leader":"Follower"),1)):T("",!0),a[21]||(a[21]=s("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),(m(!0),b(M,null,P(Object.keys(n(t).data.metrics).filter(l=>l.includes("typesense")),l=>(m(),b("div",{key:l},f(l.split("_")[2])+" : "+f(l.includes("bytes")?n(C)(parseInt(n(t).data.metrics[l],10)):n(t).data.metrics[l]),1))),128)),a[22]||(a[22]=s("div",{class:"text-subtitle1 q-pt-md"},"Stats",-1)),n(t).data.features.stats?T("",!0):(m(),b("div",qe,"Stats are not enabled on this node.")),(m(!0),b(M,null,P(n(t).data.stats,(l,x)=>(m(),b("div",{key:x},[u(l)?(m(),b("div",$e,[te(f(x)+" ",1),(m(!0),b(M,null,P(l,(Q,$)=>(m(),b("div",{key:$},f($)+" : "+f(Q),1))),128))])):T("",!0)]))),128))]),_:1})]),_:1})]),o(ae,{modelValue:v.value,"onUpdate:modelValue":a[4]||(a[4]=l=>v.value=l),persistent:""},{default:d(()=>[o(I,{style:{"min-width":"400px"}},{default:d(()=>[o(q,null,{default:d(()=>[...a[23]||(a[23]=[s("div",{class:"text-h6"},"Create Snapshot",-1),s("div",{class:"text-subtitle2 text-grey-7 q-mt-sm"}," Enter the directory path where the snapshot should be saved on the server. ",-1)])]),_:1}),o(q,{class:"q-pt-none"},{default:d(()=>[o(E,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=l=>g.value=l),outlined:"",label:"Snapshot Path",hint:"Example: /tmp/typesense-data-snapshot",rules:[l=>l&&l.length>0||"Snapshot path is required"]},null,8,["modelValue","rules"])]),_:1}),o(le,{align:"right",class:"text-primary"},{default:d(()=>[o(_,{flat:"",label:"Cancel",onClick:h}),o(_,{flat:"",label:"Create Snapshot",color:"accent",disable:!S.value,onClick:p},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Te as default};
