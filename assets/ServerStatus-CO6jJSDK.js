import{Z as O,e as E,i as R,$ as j,f,h,a0 as Y,J as A,K as G,u as Z,r as p,A as W,o as K,L as H,M as c,N as b,a1 as s,O as i,a2 as N,a3 as $,a4 as v,a5 as C,a6 as w,X as m,S as l,W as T,a7 as J,Y as q,R as X}from"./index-COFOeL2T.js";import{b as ee}from"./format-BvkBI9bc.js";import{Q}from"./QLinearProgress-BX_OVINY.js";import{Q as te}from"./QPage-BBJw8y2s.js";const ae={...O,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:e=>e>=0&&e<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},M=50,F=2*M,L=F*Math.PI,le=Math.round(L*1e3)/1e3,se=E({name:"QCircularProgress",props:{...ae,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(e,{slots:t}){const{proxy:{$q:o}}=R(),d=j(e),y=f(()=>{const u=(o.lang.rtl===!0?-1:1)*e.angle;return{transform:e.reverse!==(o.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-u}deg)`:`rotate3d(0, 0, 1, ${u-90}deg)`}}),S=f(()=>e.instantFeedback!==!0&&e.indeterminate!==!0?{transition:`stroke-dashoffset ${e.animationSpeed}ms ease 0s, stroke ${e.animationSpeed}ms ease`}:""),n=f(()=>F/(1-e.thickness/2)),a=f(()=>`${n.value/2} ${n.value/2} ${n.value} ${n.value}`),r=f(()=>ee(e.value,e.min,e.max)),g=f(()=>e.max-e.min),x=f(()=>e.thickness/2*n.value),B=f(()=>{const u=(e.max-r.value)/g.value,_=e.rounded===!0&&r.value<e.max&&u<.25?x.value/2*(1-u/.25):0;return L*u+_});function P({thickness:u,offset:_,color:D,cls:U,rounded:V}){return h("circle",{class:"q-circular-progress__"+U+(D!==void 0?` text-${D}`:""),style:S.value,fill:"transparent",stroke:"currentColor","stroke-width":u,"stroke-dasharray":le,"stroke-dashoffset":_,"stroke-linecap":V,cx:n.value,cy:n.value,r:M})}return()=>{const u=[];e.centerColor!==void 0&&e.centerColor!=="transparent"&&u.push(h("circle",{class:`q-circular-progress__center text-${e.centerColor}`,fill:"currentColor",r:M-x.value/2,cx:n.value,cy:n.value})),e.trackColor!==void 0&&e.trackColor!=="transparent"&&u.push(P({cls:"track",thickness:x.value,offset:0,color:e.trackColor})),u.push(P({cls:"circle",thickness:x.value,offset:B.value,color:e.color,rounded:e.rounded===!0?"round":void 0}));const _=[h("svg",{class:"q-circular-progress__svg",style:y.value,viewBox:a.value,"aria-hidden":"true"},u)];return e.showValue===!0&&_.push(h("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:e.fontSize}},t.default!==void 0?t.default():[h("div",r.value)])),h("div",{class:`q-circular-progress q-circular-progress--${e.indeterminate===!0?"in":""}determinate`,style:d.value,role:"progressbar","aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.indeterminate===!0?void 0:r.value},Y(t.internal,_))}}}),re=["top","middle","bottom"],I=E({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>re.includes(e)}},setup(e,{slots:t}){const o=f(()=>e.align!==void 0?{verticalAlign:e.align}:null),d=f(()=>{const y=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(y!==void 0?` text-${y}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>h("div",{class:d.value,style:o.value,role:"status","aria-label":e.label},A(t.default,e.label!==void 0?[e.label]:[]))}}),ne=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],ie=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],oe=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],de=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],z=(e,t,o)=>{let d=e;return typeof t=="string"||Array.isArray(t)?d=e.toLocaleString(t,o):(t===!0||o!==void 0)&&(d=e.toLocaleString(void 0,o)),d};function k(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const o=t.bits?t.binary?de:oe:t.binary?ie:ne,d=t.space?" ":"";if(t.signed&&e===0)return` 0${d}${o[0]}`;const y=e<0,S=y?"-":t.signed?"+":"";y&&(e=-e);let n;if(t.minimumFractionDigits!==void 0&&(n={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(n={maximumFractionDigits:t.maximumFractionDigits,...n}),e<1){const x=z(e,t.locale,n);return S+x+d+o[0]}const a=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),o.length-1);e/=(t.binary?1024:1e3)**a,n||(e=e.toPrecision(3));const r=z(Number(e),t.locale,n),g=o[a];return S+r+d+g}const ue={class:"row"},ce={class:"col col-12 col-md-8"},me={class:"row"},ve={class:"text-overline"},fe={class:"absolute-full flex flex-center"},ge={class:"absolute-full flex justify-end"},be={class:"absolute-full flex flex-center"},ye={class:"absolute-full flex justify-end"},xe={key:0},ke={key:1},he={key:2},Se={key:0},qe=G({__name:"ServerStatus",setup(e){const t=Z(),o=p(void 0),d=p(-1);function y(n){return typeof n=="object"}W(()=>{o.value=window.setInterval(()=>{t.refreshServerStatus()},2e3)}),K(()=>{window.clearInterval(o.value)});const S=f(()=>Object.entries(t.data.metrics).filter(([n])=>n.includes("cpu")).map(([n,a])=>{let r=0;const g=n.split("_");return g.length>1&&g[1]&&(r=parseInt(g[1].replace("cpu",""))||0),{node:r,value:parseFloat(a)}}).sort((n,a)=>n.node-a.node));return(n,a)=>(c(),H(te,{padding:""},{default:b(()=>[s("div",ue,[s("div",ce,[i(N,{flat:"",bordered:"",class:"q-mb-md"},{default:b(()=>[i($,null,{default:b(()=>[a[2]||(a[2]=s("div",{class:"text-h5"},"System",-1)),a[3]||(a[3]=s("div",{class:"text-subtitle1 q-pt-md"},"CPU",-1)),s("div",me,[(c(!0),v(C,null,w(S.value,r=>(c(),v("div",{key:r.node,class:"column flex-center flex-wrap q-ma-md"},[s("span",ve,"CPU "+m(r.node),1),i(se,{"show-value":"",value:r.value,size:"50px",color:"accent","track-color":"grey-3"},null,8,["value"])]))),128))]),a[4]||(a[4]=s("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),i(Q,{size:"25px",value:parseInt(l(t).data.metrics.system_memory_used_bytes,10)/parseInt(l(t).data.metrics.system_memory_total_bytes,10),color:"accent"},{default:b(()=>[s("div",fe,[i(I,{color:"white","text-color":"accent",label:l(k)(parseInt(l(t).data.metrics.system_memory_used_bytes,10))},null,8,["label"])]),s("div",ge,[i(I,{color:"white","text-color":"accent",label:l(k)(parseInt(l(t).data.metrics.system_memory_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),a[5]||(a[5]=s("div",{class:"text-subtitle1 q-pt-md"},"Disk",-1)),i(Q,{size:"25px",value:parseInt(l(t).data.metrics.system_disk_used_bytes,10)/parseInt(l(t).data.metrics.system_disk_total_bytes,10),color:"accent"},{default:b(()=>[s("div",be,[i(I,{color:"white","text-color":"accent",label:l(k)(parseInt(l(t).data.metrics.system_disk_used_bytes,10))},null,8,["label"])]),s("div",ye,[i(I,{color:"white","text-color":"accent",label:l(k)(parseInt(l(t).data.metrics.system_disk_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),a[6]||(a[6]=s("div",{class:"text-subtitle1 q-pt-md"},"System Network",-1)),s("div",null," Received: "+m(l(k)(parseInt(l(t).data.metrics.system_network_received_bytes,10)))+" Sent: "+m(l(k)(parseInt(l(t).data.metrics.system_network_sent_bytes,10))),1)]),_:1})]),_:1}),i(N,{flat:"",bordered:"",class:"q-mb-md"},{default:b(()=>[i($,null,{default:b(()=>[a[7]||(a[7]=s("div",{class:"text-h5 q-mb-md"},"Operations",-1)),a[8]||(a[8]=s("div",{class:"text-subtitle1 q-pt-md"},"Cache",-1)),a[9]||(a[9]=s("p",null," Responses of search requests that are sent with use_cache parameter are cached in a LRU cache. ",-1)),i(T,{label:"Clear Search Cache",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:l(t).clearCache},null,8,["onClick"]),a[10]||(a[10]=s("div",{class:"text-subtitle1 q-pt-md"},"Slow Request Log",-1)),a[11]||(a[11]=s("p",null,"Slow requests are logged to the primary log file, with the prefix SLOW REQUEST",-1)),i(J,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=r=>d.value=r),modelModifiers:{number:!0},outlined:"",label:"Threshold (ms)",type:"number",hint:"Enable logging of requests that take over a defined threshold of time. (-1 to disable)"},{after:b(()=>[i(T,{unelevated:"",label:"set",color:"accent",size:"md",padding:"sm lg",onClick:a[0]||(a[0]=r=>l(t).slowQueryThreshold(d.value))})]),_:1},8,["modelValue"]),a[12]||(a[12]=s("div",{class:"text-subtitle1 q-pt-md"},"Compacting the on-disk database",-1)),a[13]||(a[13]=s("p",null,"Recommended to run it during off-peak hours.",-1)),i(T,{label:"Compact Database",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:l(t).operationCompactDB},null,8,["onClick"])]),_:1})]),_:1})]),i(N,{flat:"",bordered:"",class:"col-12 col-md-3 offset-md-1 q-mb-md"},{default:b(()=>[i($,null,{default:b(()=>[a[14]||(a[14]=s("div",{class:"text-h5"},"Typesense",-1)),a[15]||(a[15]=s("div",{class:"text-subtitle1 q-pt-md"},"Node",-1)),s("div",null,"Protocol: "+m(l(t).loginData?.node.protocol),1),s("div",null,"Host: "+m(l(t).loginData?.node.host),1),s("div",null,"Port: "+m(l(t).loginData?.node.port),1),l(t).data.debug.version?(c(),v("div",xe,"Version: "+m(l(t).data.debug.version),1)):q("",!0),Object.hasOwnProperty.call(l(t).data.debug,"state")?(c(),v("div",ke," Role: "+m(l(t).data.debug.state===1?"Leader":"Follower"),1)):q("",!0),a[16]||(a[16]=s("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),(c(!0),v(C,null,w(Object.keys(l(t).data.metrics).filter(r=>r.includes("typesense")),r=>(c(),v("div",{key:r},m(r.split("_")[2])+" : "+m(r.includes("bytes")?l(k)(parseInt(l(t).data.metrics[r],10)):l(t).data.metrics[r]),1))),128)),a[17]||(a[17]=s("div",{class:"text-subtitle1 q-pt-md"},"Stats",-1)),l(t).data.features.stats?q("",!0):(c(),v("div",he,"Stats are not enabled on this node.")),(c(!0),v(C,null,w(l(t).data.stats,(r,g)=>(c(),v("div",{key:g},[y(r)?(c(),v("div",Se,[X(m(g)+" ",1),(c(!0),v(C,null,w(r,(x,B)=>(c(),v("div",{key:B},m(B)+" : "+m(x),1))),128))])):q("",!0)]))),128))]),_:1})]),_:1})])]),_:1}))}});export{qe as default};
