import{e as x,f as S,h as $,g as q,K as w,u as h,L as k,M as v,N as t,O as e,H as N,A as D,S as I,a7 as O,Q as C,W as y,R as s,X as b,aa as _}from"./index-CBEB88vI.js";import{Q as T,a as B,b as f}from"./QTable-TT2QgyZX.js";import{d as P,Q as p,a as l}from"./QSelect-wCO4Ghz2.js";import{Q as V}from"./QPage-BTm-UIH3.js";import{u as j}from"./use-quasar-CH1PUBwU.js";import{Q as A}from"./QList-CSqgV3Xp.js";import{C as E}from"./CollectionUi-B29C82EJ.js";import"./QLinearProgress-BppEsi-w.js";import"./format-BvkBI9bc.js";import"./QTabPanels-weNMpKEh.js";import"./QResizeObserver-gsU3Eslk.js";import"./touch-BjYP5sR0.js";import"./QBanner-BhRyK5_R.js";import"./MonacoEditor-r6QeIA4a.js";const z=x({name:"QTr",props:{props:Object,noHover:Boolean},setup(i,{slots:n}){const r=S(()=>"q-tr"+(i.props===void 0||i.props.header===!0?"":" "+i.props.__trClass)+(i.noHover===!0?" q-tr--no-hover":""));return()=>$("tr",{style:i.props?.__trStyle,class:r.value},q(n.default))}}),H=w({__name:"CollectionCreate",setup(i){const n=h();function r(d){const m=JSON.parse(JSON.stringify(d));for(const u of m.fields)(u.type!=="float[]"||!u.num_dim)&&delete u.num_dim,u.type.startsWith("object")&&(m.enable_nested_fields=!0);n.createCollection(m)}return(d,m)=>(v(),k(A,{bordered:"",class:"rounded-borders"},{default:t(()=>[e(T,{"expand-separator":"",icon:"sym_s_library_add","expand-icon":"sym_s_unfold_more","expanded-icon":"sym_s_unfold_less",label:"Add Collection","header-class":"bg-primary text-white"},{default:t(()=>[e(E,{"primary-action-label":"Create Collection","create-mode":"",onSubmit:r})]),_:1})]),_:1}))}}),ae=w({__name:"Collections",setup(i){const n=j(),r=h(),d=N({filter:"",columns:[{name:"name",required:!0,label:"Name",field:"name",sortable:!0},{name:"actions",required:!1,label:"Actions",field:"actions",sortable:!1},{name:"num_documents",required:!0,label:"Nb documents",field:"num_documents",sortable:!0},{name:"schema_fields",required:!0,label:"Schema fields",field:"fields",sortable:!0},{name:"created_at",required:!0,label:"Created at",field:"created_at",sortable:!0}]});D(()=>{r.getCollections()});async function m(c){n.loading.show({message:"Downloading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});try{await r.exportDocuments(c)}catch{n.dialog({title:"Export failed",message:"Try desktop version of the app."})}finally{n.loading.hide()}}function u(c){n.dialog({title:"Confirm",message:`Drop ${c} and all documents?`,cancel:!0,persistent:!0}).onOk(()=>{r.dropCollection(c)})}function Q(c){n.dialog({title:"Clone Schema",message:"Provide name for new collection? (documents are not copied!, only schema, currations and synonyms)",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(o=>{r.cloneCollectionSchema({collectionName:c,destinationName:o})})}return(c,o)=>(v(),k(V,{padding:""},{default:t(()=>[e(H),e(B,{filter:d.filter,columns:d.columns,rows:I(r).data.collections,"row-key":"name",pagination:{rowsPerPage:0,sortBy:"name"}},{body:t(a=>[e(z,{props:a},{default:t(()=>[e(f,{key:"name",props:a},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${a.row.name}/search`,size:"1.2em",class:"text-bold"},{default:t(()=>[s(b(a.row.name),1)]),_:2},1032,["to"])]),_:2},1032,["props"]),e(f,{key:"actions",props:a},{default:t(()=>[e(y,{flat:"",round:"",icon:"sym_s_more_vert"},{default:t(()=>[e(P,null,{default:t(()=>[e(p,{dense:"",clickable:"",to:`/collection/${a.row.name}/document`},{default:t(()=>[e(l,null,{default:t(()=>o[1]||(o[1]=[s("Import")])),_:1,__:[1]}),e(l,{avatar:""},{default:t(()=>[e(_,{icon:"sym_s_file_upload"})]),_:1})]),_:2},1032,["to"]),e(p,{dense:"",clickable:"",onClick:g=>m(a.row.name)},{default:t(()=>[e(l,null,{default:t(()=>o[2]||(o[2]=[s("Export")])),_:1,__:[2]}),e(l,{avatar:""},{default:t(()=>[e(_,{icon:"sym_s_file_download"})]),_:1})]),_:2},1032,["onClick"]),e(p,{dense:"",clickable:"",to:`/collection/${a.row.name}/schema`},{default:t(()=>[e(l,null,{default:t(()=>o[3]||(o[3]=[s("Edit")])),_:1,__:[3]}),e(l,{avatar:""},{default:t(()=>[e(_,{icon:"sym_s_data_object"})]),_:1})]),_:2},1032,["to"]),e(p,{dense:"",clickable:"",onClick:g=>Q(a.row.name)},{default:t(()=>[e(l,null,{default:t(()=>o[4]||(o[4]=[s("Clone Schema")])),_:1,__:[4]}),e(l,{avatar:""},{default:t(()=>[e(_,{icon:"sym_s_content_copy"})]),_:1})]),_:2},1032,["onClick"]),e(p,{dense:"",clickable:"",flat:"",style:{color:"#de3b39"},onClick:g=>u(a.row.name)},{default:t(()=>[e(l,null,{default:t(()=>o[5]||(o[5]=[s("Delete")])),_:1,__:[5]}),e(l,{avatar:""},{default:t(()=>[e(_,{icon:"sym_s_delete"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),e(f,{key:"num_documents",props:a},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${a.row.name}/search`},{default:t(()=>[s(b(a.row.num_documents)+" ",1),e(C,{name:"sym_s_search",size:"1em",right:""})]),_:2},1032,["to"])]),_:2},1032,["props"]),e(f,{key:"schema_fields",props:a},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${a.row.name}/schema`},{default:t(()=>[s(b(a.row.fields.length||0)+" ",1),e(C,{name:"sym_s_data_object",size:"1em",right:""})]),_:2},1032,["to"])]),_:2},1032,["props"]),e(f,{key:"created_at",props:a},{default:t(()=>[s(b(new Date(a.row.created_at*1e3).toLocaleString()),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":t(()=>[e(O,{modelValue:d.filter,"onUpdate:modelValue":o[0]||(o[0]=a=>d.filter=a),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:t(()=>[e(C,{name:"sym_s_search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","columns","rows"])]),_:1}))}});export{ae as default};
