import{Q as B,a as Q,b as D,c as _}from"./QTabPanels-D8czFc3j.js";import{K as J,u as M,H as j,f as r,r as d,A as E,U as x,M as R,O as s,N as e,a3 as P,Q as C,a4 as m,a7 as c,aa as F,V as I,X as p,$ as q,a9 as L,S as f,T as z,W as N,R as H}from"./index-NE-bokOZ.js";import{c as y}from"./QSelect-D6dImk3t.js";import{Q as K}from"./QBanner-UACwnb73.js";import{Q as W,a as X,b as G}from"./QTable-DxwE2Do2.js";import{Q as Y}from"./QList-4YABNyl2.js";import{Q as Z}from"./QPage-BS-xOWJk.js";import{u as h}from"./use-quasar-BfjNnnY_.js";import{M as ee}from"./MonacoEditor-CZKahp8v.js";import"./QResizeObserver-C6Jg7Opa.js";import"./touch-BjYP5sR0.js";import"./format-BvkBI9bc.js";import"./QLinearProgress-DznKP6ws.js";const le={class:"text-h6"},be=J({__name:"AnalyticsRules",setup(ae){const U=h(),n=M();function b(){return{name:"",type:"popular_queries",params:{source:{collections:[]},destination:{collection:""},expand_query:!1,limit:100}}}const t=j({rule:b(),expanded:n.data.analyticsRules.length===0,filter:"",columns:[{label:"Rule Name",name:"name",field:"name",align:"left",sortable:!0},{label:"Rule Type",name:"type",field:"type",align:"left",sortable:!0},{label:"Source Collection(s)",name:"source",field:o=>o.params.source.collections.join(", "),align:"left",sortable:!0},{label:"Destination Collection",name:"destination",field:o=>o.params.destination?.collection||"",align:"left",sortable:!0},{label:"Limit",name:"limit",field:o=>o.params.limit,align:"right",sortable:!0},{label:"Actions",name:"actions",align:"right"}]}),w=r(()=>n.data.collections.map(o=>o.name)),S=r(()=>n.data.aliases.map(o=>o.name)),g=r(()=>[...w.value,...S.value].sort()),k=d(["popular_queries","nohits_queries","counter"]),V=r(()=>n.data.analyticsRules.map(o=>o.name).includes(t.rule.name)),i=d("form"),v=r({get(){return JSON.stringify(t.rule,null,2)},set(o){try{t.rule=JSON.parse(o),u.value=null}catch(a){u.value=a.message}}}),u=d(null);async function A(){await n.createAnalyticsRule(t.rule),t.expanded=!1,t.rule=b()}function T(o){t.rule=JSON.parse(JSON.stringify(o)),t.expanded=!0}function O(o){U.dialog({title:"Confirm",message:`Delete analytics rule ${o}?`,cancel:!0,persistent:!0}).onOk(()=>{n.deleteAnalyticsRule(o)})}return E(()=>{n.getAnalyticsRules()}),(o,a)=>(R(),x(Z,{padding:""},{default:s(()=>[e(Y,{bordered:"",class:"rounded-borders"},{default:s(()=>[e(W,{modelValue:t.expanded,"onUpdate:modelValue":a[10]||(a[10]=l=>t.expanded=l),"expand-separator":"",icon:"sym_s_add_circle","expand-icon":"sym_s_unfold_more","expanded-icon":"sym_s_unfold_less",label:`${V.value?"Update":"Add"} Analytics Rule`,"header-class":"bg-primary text-white"},{default:s(()=>[e(P,null,{default:s(()=>[e(B,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=l=>i.value=l),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},{default:s(()=>[e(Q,{name:"form",label:"Form Mode"}),e(Q,{name:"json",label:"JSON Mode"})]),_:1},8,["modelValue"]),e(C),e(D,{modelValue:i.value,"onUpdate:modelValue":a[8]||(a[8]=l=>i.value=l),animated:"",class:"bg-surface"},{default:s(()=>[e(_,{name:"form"},{default:s(()=>[e(m,{class:"row q-col-gutter-md"},{default:s(()=>[e(c,{modelValue:t.rule.name,"onUpdate:modelValue":a[1]||(a[1]=l=>t.rule.name=l),class:"col-12 col-sm-6",label:"Rule Name",filled:"",rules:[l=>!!l||"Field is required"]},null,8,["modelValue","rules"]),e(y,{modelValue:t.rule.type,"onUpdate:modelValue":a[2]||(a[2]=l=>t.rule.type=l),options:k.value,class:"col-12 col-sm-6",label:"Rule Type",filled:"",rules:[l=>!!l||"Field is required"]},null,8,["modelValue","options","rules"])]),_:1}),e(m,{class:"row q-col-gutter-md"},{default:s(()=>[e(y,{modelValue:t.rule.params.source.collections,"onUpdate:modelValue":a[3]||(a[3]=l=>t.rule.params.source.collections=l),class:"col-12 col-sm-6",label:"Source Collection(s)",filled:"",options:g.value,multiple:"",hint:"Track searches sent to these collections or aliases"},null,8,["modelValue","options"]),e(y,{modelValue:t.rule.params.destination.collection,"onUpdate:modelValue":a[4]||(a[4]=l=>t.rule.params.destination.collection=l),class:"col-12 col-sm-6",label:"Destination Collection",filled:"",options:g.value},null,8,["modelValue","options"])]),_:1}),e(m,{class:"row q-col-gutter-md"},{default:s(()=>[e(c,{modelValue:t.rule.params.limit,"onUpdate:modelValue":a[5]||(a[5]=l=>t.rule.params.limit=l),class:"col-12 col-sm-6",label:"Limit",filled:"",type:"number",min:"0"},null,8,["modelValue"]),e(F,{modelValue:t.rule.params.expand_query,"onUpdate:modelValue":a[6]||(a[6]=l=>t.rule.params.expand_query=l),class:"col-12 col-sm-6",label:"Expand Query",filled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{name:"json",class:"q-pa-none"},{default:s(()=>[e(ee,{modelValue:v.value,"onUpdate:modelValue":a[7]||(a[7]=l=>v.value=l),style:{height:"60vh"}},null,8,["modelValue"]),u.value?(R(),x(K,{key:0,"inline-actions":"",class:"text-white bg-red"},{default:s(()=>[p(" Invalid Format: "+q(u.value),1)]),_:1})):I("",!0)]),_:1})]),_:1},8,["modelValue"]),e(C),e(L,{align:"right",class:"bg-primary"},{default:s(()=>[e(f,{size:"md",padding:"sm lg",unelevated:"",color:"primary",onClick:a[9]||(a[9]=l=>A())},{default:s(()=>[p(q(V.value?"Update":"Add")+" Rule ",1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","label"])]),_:1}),e(X,{class:"q-mt-md",title:"Analytics Rules",flat:"",bordered:"",filter:t.filter,rows:z(n).data.analyticsRules,columns:t.columns,"row-key":"name",pagination:{rowsPerPage:50,sortBy:"name"}},{"top-left":s(()=>[H("div",le,[e(N,{size:"md",name:"sym_s_query_stats"}),a[12]||(a[12]=p(" Analytics Rules",-1))])]),"top-right":s(()=>[e(c,{modelValue:t.filter,"onUpdate:modelValue":a[11]||(a[11]=l=>t.filter=l),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:s(()=>[e(N,{name:"sym_s_search"})]),_:1},8,["modelValue"])]),"body-cell-actions":s(l=>[e(G,{class:"text-right"},{default:s(()=>[e(f,{flat:"",icon:"sym_s_edit",title:"Edit",onClick:$=>T(l.row)},null,8,["onClick"]),e(f,{flat:"",color:"negative",icon:"sym_s_delete_forever",title:"Delete",onClick:$=>O(l.row.name)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["filter","rows","columns"])]),_:1}))}});export{be as default};
