import{K as V,u as N,H as D,f as Q,w as b,U as p,M as n,O as a,R as l,N as d,V as C,X as u,W as S,$ as m,T as g,S as y,L as c,a5 as j,a6 as T,ab as B}from"./index-CEKgHZlV.js";import{Q as v}from"./QBanner-vvPrIn6E.js";import{c as O}from"./QSelect-BTcpWXTK.js";import{Q as U}from"./QPage-ClJgVpfE.js";import{M as A}from"./MonacoEditor-8i3JrqBJ.js";import{u as F}from"./use-quasar-CFBXNBPC.js";import"./format-BvkBI9bc.js";import"./QResizeObserver-BvVLTfsL.js";const J={class:"row justify-between q-mb-md"},$={class:"text-h5"},z={key:0},I={class:"row q-mb-md bg-primary text-white justify-between"},P={class:"row col-auto"},q={key:0},M={key:1},ee=V({__name:"Document",setup(L){const i=F(),r=N(),e=D({jsonError:null,documents:[],results:[],action:"upsert"}),x=["create","upsert","update"],E={create:"Create a new document. Fails if id exists.",upsert:"Create a new document or update an existing document.",update:"Update an existing document. Partial document allowed."},f=Q({get:()=>JSON.stringify(e.documents,null,2),set:o=>{try{e.documents=JSON.parse(o),e.jsonError=null}catch(t){e.jsonError=t.message}}});b(()=>r.currentCollection,()=>{e.documents=[],_()},{immediate:!0}),b(()=>r.documentsToEdit,()=>{r.documentsToEdit&&r.documentsToEdit.length>0&&(e.documents=r.documentsToEdit||[],e.action="upsert",r.setDocumentsToEdit([]))},{immediate:!0});async function k(){e.results=[];try{i.loading.show({message:"Uploading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});let o=await r.api?.importFile(r.currentCollection?.name,e.action);Array.isArray(o)||(o=[{error:o}]),e.results=o}catch(o){e.results=[{error:o.message}]}i.loading.hide()}async function h(){e.results=[];try{i.loading.show({message:"Uploading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),e.results=await r.importDocuments({action:e.action,documents:JSON.parse(JSON.stringify(e.documents))})}catch(o){e.results=[{error:o.message}]}i.loading.hide()}function _(){let o={};r.currentCollection&&r.currentCollection.fields&&(o=r.currentCollection.fields.reduce((t,s)=>(t[s.name]=s.type.includes("[]")?[]:s.type.includes("string")?"":s.type.includes("bool")?!1:0,t),{})),e.documents.push(o)}return(o,t)=>(n(),p(U,{padding:"",class:"column"},{default:a(()=>[l("div",J,[l("div",$,[d(S,{size:"md",name:"sym_s_library_add"}),u(" Add Documents to "+m(g(r).currentCollection?.name),1)]),d(y,{unelevated:"",disable:!g(i).platform.is.electron,icon:"sym_s_attach_file",onClick:t[0]||(t[0]=s=>k())},{default:a(()=>[t[5]||(t[5]=u(" Import from file ")),g(i).platform.is.electron?C("",!0):(n(),c("span",z," (only desktop version)"))]),_:1,__:[5]},8,["disable"])]),d(A,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),style:{"min-height":"200px"}},null,8,["modelValue"]),e.jsonError?(n(),p(v,{key:0,"inline-actions":"",class:"text-white bg-red"},{default:a(()=>[u(" Invalid Format: "+m(e.jsonError),1)]),_:1})):C("",!0),l("div",I,[d(y,{unelevated:"",size:"md",padding:"sm lg",color:"primary",onClick:t[2]||(t[2]=s=>_())},{default:a(()=>t[6]||(t[6]=[u("Add empty Document")])),_:1,__:[6]}),l("div",P,[d(O,{modelValue:e.action,"onUpdate:modelValue":t[3]||(t[3]=s=>e.action=s),dark:"","bottom-slots":"",label:"Action mode",filled:"",style:{width:"300px"},options:x},{hint:a(()=>[l("div",null,m(E[e.action]),1)]),_:1},8,["modelValue"]),d(y,{unelevated:"",size:"md",padding:"sm xl",color:"primary",disable:!!e.jsonError,onClick:t[4]||(t[4]=s=>h())},{default:a(()=>t[7]||(t[7]=[u("Import")])),_:1,__:[7]},8,["disable"])])]),l("div",null,[(n(!0),c(j,null,T(e.results,(s,w)=>(n(),p(v,{key:w,class:B(["text-white",{"bg-green":s.success,"bg-red":s.error}])},{default:a(()=>[u(m(w)+": ",1),s.success?(n(),c("span",q,m(s.success),1)):(n(),c("span",M,m(s.error),1))]),_:2},1032,["class"]))),128))])]),_:1}))}});export{ee as default};
