import{e as x,f as S,h as $,g as q,K as w,u as h,L as k,M as v,N as t,O as e,H as N,A as D,S as I,a7 as O,Q as C,W as y,R as s,X as b,a9 as f}from"./index-CZ34aOlc.js";import{Q as T,a as B,b as _}from"./QTable-8anm0jr2.js";import{d as P,Q as p,a as l}from"./QSelect-CJWtbzyH.js";import{Q as V}from"./QPage-B5XGvNR1.js";import{u as j}from"./use-quasar-DTyF875P.js";import{Q as A}from"./QList-QcH4d0WG.js";import{C as E}from"./CollectionUi-BWtC5vLT.js";import"./QLinearProgress-C9I0_JEM.js";import"./format-BvkBI9bc.js";import"./QTabPanels-BS2GwC6l.js";import"./QResizeObserver-CgmnWCx4.js";import"./touch-BjYP5sR0.js";import"./QBanner-FjKZFzlo.js";import"./MonacoEditor-D_EAl6Gs.js";const z=x({name:"QTr",props:{props:Object,noHover:Boolean},setup(c,{slots:n}){const r=S(()=>"q-tr"+(c.props===void 0||c.props.header===!0?"":" "+c.props.__trClass)+(c.noHover===!0?" q-tr--no-hover":""));return()=>$("tr",{class:r.value},q(n.default))}}),H=w({__name:"CollectionCreate",setup(c){const n=h();function r(i){const m=JSON.parse(JSON.stringify(i));for(const u of m.fields)(u.type!=="float[]"||!u.num_dim)&&delete u.num_dim,u.type.startsWith("object")&&(m.enable_nested_fields=!0);n.createCollection(m)}return(i,m)=>(v(),k(A,{bordered:"",class:"rounded-borders"},{default:t(()=>[e(T,{"expand-separator":"",icon:"sym_s_library_add","expand-icon":"sym_s_unfold_more","expanded-icon":"sym_s_unfold_less",label:"Add Collection","header-class":"bg-primary text-white"},{default:t(()=>[e(E,{"primary-action-label":"Create Collection","create-mode":"",onSubmit:r})]),_:1})]),_:1}))}}),oe=w({__name:"Collections",setup(c){const n=j(),r=h(),i=N({filter:"",columns:[{name:"name",required:!0,label:"Name",field:"name",sortable:!0},{name:"actions",required:!1,label:"Actions",field:"actions",sortable:!1},{name:"num_documents",required:!0,label:"Nb documents",field:"num_documents",sortable:!0},{name:"schema_fields",required:!0,label:"Schema fields",field:"fields",sortable:!0},{name:"created_at",required:!0,label:"Created at",field:"created_at",sortable:!0}]});D(()=>{r.getCollections()});async function m(d){n.loading.show({message:"Downloading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});try{await r.exportDocuments(d)}catch{n.dialog({title:"Export failed",message:"Try desktop version of the app."})}finally{n.loading.hide()}}function u(d){n.dialog({title:"Confirm",message:`Drop ${d} and all documents?`,cancel:!0,persistent:!0}).onOk(()=>{r.dropCollection(d)})}function Q(d){n.dialog({title:"Clone Schema",message:"Provide name for new collection? (documents are not copied!, only schema, currations and synonyms)",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(a=>{r.cloneCollectionSchema({collectionName:d,destinationName:a})})}return(d,a)=>(v(),k(V,{padding:""},{default:t(()=>[e(H),e(B,{filter:i.filter,columns:i.columns,rows:I(r).data.collections,"row-key":"name",pagination:{rowsPerPage:0,sortBy:"name"}},{body:t(o=>[e(z,{props:o},{default:t(()=>[e(_,{key:"name",props:o},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${o.row.name}/search`,size:"1.2em",class:"text-bold"},{default:t(()=>[s(b(o.row.name),1)]),_:2},1032,["to"])]),_:2},1032,["props"]),e(_,{key:"actions",props:o},{default:t(()=>[e(y,{flat:"",round:"",icon:"sym_s_more_vert"},{default:t(()=>[e(P,null,{default:t(()=>[e(p,{dense:"",clickable:"",to:`/collection/${o.row.name}/document`},{default:t(()=>[e(l,null,{default:t(()=>a[1]||(a[1]=[s("Import")])),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_file_upload"})]),_:1})]),_:2},1032,["to"]),e(p,{dense:"",clickable:"",onClick:g=>m(o.row.name)},{default:t(()=>[e(l,null,{default:t(()=>a[2]||(a[2]=[s("Export")])),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_file_download"})]),_:1})]),_:2},1032,["onClick"]),e(p,{dense:"",clickable:"",to:`/collection/${o.row.name}/schema`},{default:t(()=>[e(l,null,{default:t(()=>a[3]||(a[3]=[s("Edit")])),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_data_object"})]),_:1})]),_:2},1032,["to"]),e(p,{dense:"",clickable:"",onClick:g=>Q(o.row.name)},{default:t(()=>[e(l,null,{default:t(()=>a[4]||(a[4]=[s("Clone Schema")])),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_content_copy"})]),_:1})]),_:2},1032,["onClick"]),e(p,{dense:"",clickable:"",flat:"",style:{color:"#de3b39"},onClick:g=>u(o.row.name)},{default:t(()=>[e(l,null,{default:t(()=>a[5]||(a[5]=[s("Delete")])),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_delete"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),e(_,{key:"num_documents",props:o},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${o.row.name}/search`},{default:t(()=>[s(b(o.row.num_documents)+" ",1),e(C,{name:"sym_s_search",size:"1em",right:""})]),_:2},1032,["to"])]),_:2},1032,["props"]),e(_,{key:"schema_fields",props:o},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${o.row.name}/schema`},{default:t(()=>[s(b(o.row.fields.length||0)+" ",1),e(C,{name:"sym_s_data_object",size:"1em",right:""})]),_:2},1032,["to"])]),_:2},1032,["props"]),e(_,{key:"created_at",props:o},{default:t(()=>[s(b(new Date(o.row.created_at*1e3).toLocaleString()),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":t(()=>[e(O,{modelValue:i.filter,"onUpdate:modelValue":a[0]||(a[0]=o=>i.filter=o),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:t(()=>[e(C,{name:"sym_s_search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","columns","rows"])]),_:1}))}});export{oe as default};
