import{e as x,f as S,h as $,g as q,K as w,u as h,U as k,M as v,O as t,N as e,H as N,A as T,T as D,a7 as I,W as C,S as y,X as s,$ as b,ab as f}from"./index-TreL_WJR.js";import{Q as O,a as B,b as _}from"./QTable-BDOh6kVp.js";import{d as P,a as p,Q as l}from"./QSelect-DI4b5CBb.js";import{Q as V}from"./QPage-BEEUHEA3.js";import{u as j}from"./use-quasar-BZWIP0gQ.js";import{Q as A}from"./QList-CP_2Mym6.js";import{C as E}from"./CollectionUi-BCMOp8MM.js";import"./QLinearProgress-CpLcujzc.js";import"./format-BvkBI9bc.js";import"./QTabPanels-8zz-6uay.js";import"./QResizeObserver-DQ42bq8d.js";import"./touch-BjYP5sR0.js";import"./QBanner-DHWR3dzq.js";import"./MonacoEditor-BIY3YNJC.js";const z=x({name:"QTr",props:{props:Object,noHover:Boolean},setup(i,{slots:n}){const r=S(()=>"q-tr"+(i.props===void 0||i.props.header===!0?"":" "+i.props.__trClass)+(i.noHover===!0?" q-tr--no-hover":""));return()=>$("tr",{style:i.props?.__trStyle,class:r.value},q(n.default))}}),H=w({__name:"CollectionCreate",setup(i){const n=h();function r(d){const m=JSON.parse(JSON.stringify(d));for(const u of m.fields)(u.type!=="float[]"||!u.num_dim)&&delete u.num_dim,u.type.startsWith("object")&&(m.enable_nested_fields=!0);n.createCollection(m)}return(d,m)=>(v(),k(A,{bordered:"",class:"rounded-borders"},{default:t(()=>[e(O,{"expand-separator":"",icon:"sym_s_library_add","expand-icon":"sym_s_unfold_more","expanded-icon":"sym_s_unfold_less",label:"Add Collection","header-class":"bg-primary text-white"},{default:t(()=>[e(E,{"primary-action-label":"Create Collection","create-mode":"",onSubmit:r})]),_:1})]),_:1}))}}),oe=w({__name:"Collections",setup(i){const n=j(),r=h(),d=N({filter:"",columns:[{name:"name",required:!0,label:"Name",field:"name",sortable:!0},{name:"actions",required:!1,label:"Actions",field:"actions",sortable:!1},{name:"num_documents",required:!0,label:"Nb documents",field:"num_documents",sortable:!0},{name:"schema_fields",required:!0,label:"Schema fields",field:"fields",sortable:!0},{name:"created_at",required:!0,label:"Created at",field:"created_at",sortable:!0}]});T(()=>{r.getCollections()});async function m(c){n.loading.show({message:"Downloading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});try{await r.exportDocuments(c)}catch{n.dialog({title:"Export failed",message:"Try desktop version of the app."})}finally{n.loading.hide()}}function u(c){n.dialog({title:"Confirm",message:`Drop ${c} and all documents?`,cancel:!0,persistent:!0}).onOk(()=>{r.dropCollection(c)})}function Q(c){n.dialog({title:"Clone Schema",message:"Provide name for new collection? (documents are not copied!, only schema, currations and synonyms)",prompt:{model:"",type:"text"},cancel:!0,persistent:!0}).onOk(a=>{r.cloneCollectionSchema({collectionName:c,destinationName:a})})}return(c,a)=>(v(),k(V,{padding:""},{default:t(()=>[e(H),e(B,{filter:d.filter,columns:d.columns,rows:D(r).data.collections,"row-key":"name",pagination:{rowsPerPage:0,sortBy:"name"}},{body:t(o=>[e(z,{props:o},{default:t(()=>[e(_,{key:"name",props:o},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${o.row.name}/search`,size:"1.2em",class:"text-bold"},{default:t(()=>[s(b(o.row.name),1)]),_:2},1032,["to"])]),_:2},1032,["props"]),e(_,{key:"actions",props:o},{default:t(()=>[e(y,{flat:"",round:"",icon:"sym_s_more_vert"},{default:t(()=>[e(P,null,{default:t(()=>[e(p,{dense:"",clickable:"",to:`/collection/${o.row.name}/document`},{default:t(()=>[e(l,null,{default:t(()=>[...a[1]||(a[1]=[s("Import",-1)])]),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_file_upload"})]),_:1})]),_:2},1032,["to"]),e(p,{dense:"",clickable:"",onClick:g=>m(o.row.name)},{default:t(()=>[e(l,null,{default:t(()=>[...a[2]||(a[2]=[s("Export",-1)])]),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_file_download"})]),_:1})]),_:2},1032,["onClick"]),e(p,{dense:"",clickable:"",to:`/collection/${o.row.name}/schema`},{default:t(()=>[e(l,null,{default:t(()=>[...a[3]||(a[3]=[s("Edit",-1)])]),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_data_object"})]),_:1})]),_:2},1032,["to"]),e(p,{dense:"",clickable:"",onClick:g=>Q(o.row.name)},{default:t(()=>[e(l,null,{default:t(()=>[...a[4]||(a[4]=[s("Clone Schema",-1)])]),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_content_copy"})]),_:1})]),_:2},1032,["onClick"]),e(p,{dense:"",clickable:"",flat:"",style:{color:"#de3b39"},onClick:g=>u(o.row.name)},{default:t(()=>[e(l,null,{default:t(()=>[...a[5]||(a[5]=[s("Delete",-1)])]),_:1}),e(l,{avatar:""},{default:t(()=>[e(f,{icon:"sym_s_delete"})]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"]),e(_,{key:"num_documents",props:o},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${o.row.name}/search`},{default:t(()=>[s(b(o.row.num_documents)+" ",1),e(C,{name:"sym_s_search",size:"1em",right:""})]),_:2},1032,["to"])]),_:2},1032,["props"]),e(_,{key:"schema_fields",props:o},{default:t(()=>[e(y,{"no-caps":"",flat:"",to:`/collection/${o.row.name}/schema`},{default:t(()=>[s(b(o.row.fields.length||0)+" ",1),e(C,{name:"sym_s_data_object",size:"1em",right:""})]),_:2},1032,["to"])]),_:2},1032,["props"]),e(_,{key:"created_at",props:o},{default:t(()=>[s(b(new Date(o.row.created_at*1e3).toLocaleString()),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),"top-right":t(()=>[e(I,{modelValue:d.filter,"onUpdate:modelValue":a[0]||(a[0]=o=>d.filter=o),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:t(()=>[e(C,{name:"sym_s_search"})]),_:1},8,["modelValue"])]),_:1},8,["filter","columns","rows"])]),_:1}))}});export{oe as default};
