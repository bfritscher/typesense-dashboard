import{K as O,u as N,H as w,f as d,A as S,U as f,M as v,O as r,N as l,a3 as k,V as E,a4 as U,a7 as g,X as s,$ as _,a9 as I,S as n,T as J,W as y,R as $}from"./index-BTiO3EOl.js";import{Q as j}from"./QBanner-D7DLhR-L.js";import{Q as q,a as D,b as A}from"./QTable-B3vxj2W5.js";import{Q as B}from"./QPage-4I5DqbU4.js";import{u as M}from"./use-quasar-Dx1WlHzY.js";import{n as u}from"./index.browser-OxPLOBIU.js";import{M as T}from"./MonacoEditor-n3R3HmWT.js";import"./QItem-CTM6MChZ.js";import"./QSelect-JfnYGCod.js";import"./QChip-CO2E2fvA.js";import"./QList-DRl8fJm7.js";import"./QLinearProgress-CLZiPA0A.js";import"./QResizeObserver-ChJHnOs-.js";const z={class:"text-h6"},le=O({__name:"Overrides",setup(F){const b=M(),o=N(),m={rule:{query:"apple",match:"exact"},includes:[{id:"422",position:1},{id:"54",position:2}],excludes:[{id:"287"}]},e=w({id:u(),override:m,jsonError:null,expanded:o.data.overrides.length===0,filter:"",columns:[{label:"ID",name:"id",field:"id"},{label:"Query",name:"query",field:a=>a.rule.query,sortable:!0,align:"left"},{label:"Match",name:"match",field:a=>a.rule.match,sortable:!0,align:"left"},{label:"Includes",name:"includes",field:a=>a.includes?.length},{label:"Excludes",name:"excludes",field:a=>a.excludes?.length},{label:"Actions",name:"actions",align:"right"}]}),x=d(()=>e.id.length>0&&!e.jsonError),c=d(()=>o.data.overrides.map(a=>a.id).includes(e.id)),p=d({get:()=>JSON.stringify(e.override,null,2),set:a=>{try{e.override=JSON.parse(a),e.jsonError=null}catch(t){e.jsonError=t.message}}});async function C(){await o.createOverride({id:e.id,override:JSON.parse(JSON.stringify(e.override))}),e.id=u(),e.override=m,e.expanded=!1}function V(a){e.override=JSON.parse(JSON.stringify(a)),e.id=a.id||u(),e.expanded=!0}function h(a){b.dialog({title:"Confirm",message:`Delete curation with id: ${a}?`,cancel:!0,persistent:!0}).onOk(()=>{o.deleteOverride(a)})}return S(()=>{o.currentCollection&&o.getOverrides(o.currentCollection.name)}),(a,t)=>(v(),f(B,{padding:""},{default:r(()=>[l(q,{modelValue:e.expanded,"onUpdate:modelValue":t[3]||(t[3]=i=>e.expanded=i),"expand-separator":"",icon:"sym_s_add_circle","expand-icon":"sym_s_unfold_more","expanded-icon":"sym_s_unfold_less",label:`${c.value?"Update":"Add"} Curation`,"header-class":"bg-primary text-white"},{default:r(()=>[l(k,{style:{height:"60vh"},class:"bg-surface column"},{default:r(()=>[l(U,null,{default:r(()=>[l(g,{modelValue:e.id,"onUpdate:modelValue":t[0]||(t[0]=i=>e.id=i),dense:"",filled:"",label:"ID"},null,8,["modelValue"])]),_:1}),l(T,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=i=>p.value=i)},null,8,["modelValue"]),e.jsonError?(v(),f(j,{key:0,"inline-actions":"",class:"text-white bg-red"},{default:r(()=>[s(" Invalid Format: "+_(e.jsonError),1)]),_:1})):E("",!0),l(I,{align:"right",class:"bg-primary"},{default:r(()=>[l(n,{size:"md",padding:"sm lg",unelevated:"",color:"primary",disable:!x.value,onClick:t[2]||(t[2]=i=>C())},{default:r(()=>[s(_(c.value?"Update":"Add")+" Curation",1)]),_:1},8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue","label"]),l(D,{class:"q-mt-md",title:"Curations",flat:"",bordered:"",filter:e.filter,rows:J(o).data.overrides,columns:e.columns,"row-key":"id","visible-columns":["query","match","includes","excludes","actions"]},{"top-left":r(()=>[$("div",z,[l(y,{size:"md",name:"sym_s_low_priority"}),t[5]||(t[5]=s(" Curations",-1))])]),"top-right":r(()=>[l(g,{modelValue:e.filter,"onUpdate:modelValue":t[4]||(t[4]=i=>e.filter=i),borderless:"",dense:"",debounce:"300",placeholder:"Search"},{append:r(()=>[l(y,{name:"sym_s_search"})]),_:1},8,["modelValue"])]),"body-cell-actions":r(i=>[l(A,{class:"text-right"},{default:r(()=>[l(n,{flat:"",icon:"sym_s_edit",title:"Edit",onClick:Q=>V(i.row)},null,8,["onClick"]),l(n,{flat:"",color:"negative",icon:"sym_s_delete_forever",title:"Delete",onClick:Q=>h(i.row.id)},null,8,["onClick"])]),_:2},1024)]),_:1},8,["filter","rows","columns"])]),_:1}))}});export{le as default};
