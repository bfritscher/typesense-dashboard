import{Q as D}from"./QSpace-xHLF6U3K.js";import{Q as Y}from"./QBanner-D7DLhR-L.js";import{Q as Z}from"./QPage-4I5DqbU4.js";import{K,r as k,f as d,A as ee,o as te,w as se,U as c,M as t,a3 as oe,O as f,N as h,R as a,L as r,V as q,$ as n,X as _,a5 as p,S as ae,a6 as N,a4 as ne,b7 as re,u as le,T}from"./index-BTiO3EOl.js";import{Q as ie,_ as ue,p as de}from"./HealthTag.vue_vue_type_script_setup_true_lang-BtXeBZn9.js";import{Q as $}from"./QChip-CO2E2fvA.js";import{Q as P}from"./QLinearProgress-CLZiPA0A.js";const ce={class:"row items-center no-wrap q-mb-sm"},ve={class:"text-subtitle1"},me={class:"row items-center no-wrap q-mb-xs"},ye={class:"text-caption"},_e={key:0,class:"text-negative text-body2"},pe={key:1},fe={class:"text-caption q-mt-xs"},ge={class:"text-caption q-mt-xs"},be={class:"text-caption q-mt-xs"},ke={class:"text-caption"},he={class:"text-caption"},xe={key:3,class:"text-caption"},we={key:4,class:"scroll"},Se={key:0},qe={class:"text-caption q-mt-xs"},Ce={class:"text-caption"},Oe={class:"text-caption"},Qe={class:"text-caption q-mt-md"},Ne=K({__name:"NodeStatusCard",props:{entry:{},refreshTrigger:{},isCurrent:{type:Boolean}},emits:["connect"],setup(x){const v=x,g=new re,o=k({}),u=k({}),i=k({}),m=k(null),y=k(null),C=k(void 0),j=k(null);function R(){g.init({node:v.entry.node,apiKey:v.entry.apiKey})}async function B(){try{let s=function(S){return S!==null&&typeof S=="object"},e=function(S){return s(S)&&"data"in S};y.value=null;const[l,O,w,Q]=await Promise.all([Promise.resolve(g.get("/metrics.json")),Promise.resolve(g.getDebug()),Promise.resolve(g.get("/stats.json")).catch(()=>{}),Promise.resolve(g.get("/health")).catch(()=>{})]),H=e(l)?l.data:l??{};o.value=H||{},u.value=O||{};const W=e(w)?w.data:w??{};i.value=W||{},m.value=Q.data||null,j.value=Date.now()}catch(s){y.value=s?.message||"Failed to fetch"}}const U=d(()=>{const s=parseInt(String(o.value.system_memory_used_bytes||0),10),e=parseInt(String(o.value.system_memory_total_bytes||1),10);return e>0?s/e:0}),V=d(()=>{const s=parseInt(String(o.value.system_disk_used_bytes||0),10),e=parseInt(String(o.value.system_disk_total_bytes||1),10);return e>0?s/e:0}),I=d(()=>Object.prototype.hasOwnProperty.call(o.value||{},"system_cpu_active_percentage")),M=d(()=>{const s=(o.value||{}).system_cpu_active_percentage,e=typeof s=="number"?s:typeof s=="string"?parseFloat(s):NaN;return isFinite(e)?Math.max(0,Math.min(1,e/100)):0}),z=d(()=>Math.round(M.value*100)),A=d(()=>{const s=o.value||{};return Object.keys(s).filter(e=>/^system_cpu\d+_active_percentage$/.test(e)).length}),F=d(()=>u.value?.version),L=d(()=>Object.hasOwn(u.value||{},"state")?u.value.state===1?"Leader":"Follower":void 0),J=d(()=>j.value?`${Math.round((Date.now()-j.value)/1e3)}s ago`:"—");function b(s){return!s&&s!==0?"-":de(parseInt(String(s),10))}const E=d(()=>Object.keys(i.value||{}).length>0),X=d(()=>i.value||{});function G(s){return typeof s=="object"&&s!==null}return ee(()=>{R(),B(),C.value=window.setInterval(()=>{B()},2e3)}),te(()=>{C.value&&window.clearInterval(C.value)}),se(()=>v.refreshTrigger,()=>{B()}),(s,e)=>(t(),c(oe,{flat:"",bordered:""},{default:f(()=>[h(ne,null,{default:f(()=>[a("div",ce,[a("div",ve,n(x.entry.node.protocol)+"://"+n(x.entry.node.host)+":"+n(x.entry.node.port),1),h(D),F.value?(t(),c(ie,{key:0,color:"info",outline:""},{default:f(()=>[_(" v"+n(F.value),1)]),_:1})):q("",!0)]),a("div",me,[a("div",ye,[L.value?(t(),r(p,{key:0},[L.value==="Leader"?(t(),c($,{key:0,color:"positive","text-color":"white",dense:"",square:""},{default:f(()=>[...e[1]||(e[1]=[_(" Leader ",-1)])]),_:1})):(t(),c($,{key:1,color:"grey-6","text-color":"white",dense:"",square:""},{default:f(()=>[...e[2]||(e[2]=[_("Follower",-1)])]),_:1}))],64)):(t(),r(p,{key:1},[_(" Role: - ")],64))]),h(D),a("div",null,[h(ue,{health:m.value},null,8,["health"]),x.isCurrent?(t(),c($,{key:0,color:"positive","text-color":"white",dense:""},{default:f(()=>[...e[3]||(e[3]=[_("Current",-1)])]),_:1})):(t(),c(ae,{key:1,dense:"",flat:"",size:"sm",label:"Connect",onClick:e[0]||(e[0]=l=>s.$emit("connect"))}))])]),y.value?(t(),r("div",_e,n(y.value),1)):(t(),r("div",pe,[e[4]||(e[4]=a("div",{class:"q-mb-sm"},"CPU",-1)),I.value?(t(),c(P,{key:0,size:"12px",value:M.value,color:"accent"},null,8,["value"])):q("",!0),a("div",fe,[I.value?(t(),r(p,{key:0},[_(n(z.value)+"% · "+n(A.value)+" cores ",1)],64)):(t(),r(p,{key:1},[_(" - ")],64))]),e[5]||(e[5]=a("div",{class:"q-mb-sm"},"Memory",-1)),o.value.system_memory_total_bytes&&o.value.system_memory_used_bytes?(t(),c(P,{key:1,size:"12px",value:U.value,color:"accent"},null,8,["value"])):q("",!0),a("div",ge,n(b(o.value.system_memory_used_bytes))+" / "+n(b(o.value.system_memory_total_bytes)),1),e[6]||(e[6]=a("div",{class:"q-mt-md q-mb-sm"},"Disk",-1)),o.value.system_disk_total_bytes&&o.value.system_disk_used_bytes?(t(),c(P,{key:2,size:"12px",value:V.value,color:"accent"},null,8,["value"])):q("",!0),a("div",be,n(b(o.value.system_disk_used_bytes))+" / "+n(b(o.value.system_disk_total_bytes)),1),e[7]||(e[7]=a("div",{class:"q-mt-md q-mb-xs"},"Typesense Memory",-1)),a("div",ke,[(t(!0),r(p,null,N(Object.keys(o.value).filter(l=>l.includes("typesense")),l=>(t(),r("div",{key:l},n(l.split("_")[2])+" : "+n(l.includes("bytes")?b(o.value[l]):o.value[l]),1))),128))]),e[8]||(e[8]=a("div",{class:"q-mt-md q-mb-xs"},"System Network",-1)),a("div",he," Rx: "+n(b(o.value.system_network_received_bytes))+" · Tx: "+n(b(o.value.system_network_sent_bytes)),1),e[9]||(e[9]=a("div",{class:"q-mt-md q-mb-xs"},"Stats",-1)),E.value?(t(),r("div",we,[(t(!0),r(p,null,N(X.value,(l,O)=>(t(),r("div",{key:String(O)},[G(l)?(t(),r("div",Se,[a("div",qe,n(O),1),(t(!0),r(p,null,N(l,(w,Q)=>(t(),r("div",{key:String(Q),class:"row no-wrap justify-between"},[a("div",Ce,n(Q),1),a("div",Oe,n(w),1)]))),128))])):q("",!0)]))),128))])):(t(),r("div",xe,"Stats are not enabled on this node.")),a("div",Qe,"Updated: "+n(J.value),1)]))]),_:1})]),_:1}))}}),je={class:"row items-center q-mb-md"},Be={key:0},$e={key:1,class:"row q-col-gutter-md"},Ke=K({__name:"ClusterStatus",setup(x){const v=le();function g(u){const i=v.loginData;if(!i)return!1;const m=String(i.apiKey)===String(u.apiKey),y=JSON.stringify(i.node)===JSON.stringify(u.node);return m&&y}function o(u){v.login({node:u.node,apiKey:u.apiKey})}return(u,i)=>(t(),c(Z,{padding:""},{default:f(()=>[a("div",je,[i[0]||(i[0]=a("div",{class:"text-h5 q-mr-md"},"Cluster Status",-1)),h(D)]),T(v).currentClusterTag?(t(),r("div",$e,[(t(!0),r(p,null,N(T(v).clusterMembersForCurrent,(m,y)=>(t(),r("div",{key:y,class:"col-12 col-md-6 col-lg-4"},[h(Ne,{entry:m,"is-current":g(m),onConnect:C=>o(m)},null,8,["entry","is-current","onConnect"])]))),128))])):(t(),r("div",Be,[h(Y,{rounded:"",class:"bg-grey-2 text-grey-9 q-pa-md"},{default:f(()=>[...i[1]||(i[1]=[_(" Current server is not part of a cluster. ",-1)])]),_:1})]))]),_:1}))}});export{Ke as default};
