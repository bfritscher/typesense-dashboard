import{p as C,Q as V,_ as oe}from"./HealthTag.vue_vue_type_script_setup_true_lang-BX07o12X.js";import{Q as E}from"./QLinearProgress-BCf7bIDz.js";import{a0 as ne,e as re,i as ue,a1 as ie,f as u,h as q,a2 as de,K as ce,u as me,r as O,A as ve,o as fe,U as S,M as i,O as d,R as o,N as n,a3 as F,a4 as D,V as g,L as v,a5 as N,a6 as P,$ as c,T as r,S as _,a7 as X,X as R,a8 as pe,a9 as ye}from"./index-CNyTRbVy.js";import{b as be,a as he,Q as Z}from"./QItem-TxCjIglU.js";import{Q as ge}from"./QChip-BMD_gwyW.js";import{Q as ke}from"./QList-BLy8dhP3.js";import{Q as xe}from"./QPage-DCzU5bFx.js";const Ce={...ne,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:l=>l>=0&&l<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},A=50,J=2*A,Y=J*Math.PI,Se=Math.round(Y*1e3)/1e3,_e=re({name:"QCircularProgress",props:{...Ce,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(l,{slots:s}){const{proxy:{$q:Q}}=ue(),B=ie(l),k=u(()=>{const m=(Q.lang.rtl===!0?-1:1)*l.angle;return{transform:l.reverse!==(Q.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-m}deg)`:`rotate3d(0, 0, 1, ${m-90}deg)`}}),p=u(()=>l.instantFeedback!==!0&&l.indeterminate!==!0?{transition:`stroke-dashoffset ${l.animationSpeed}ms ease 0s, stroke ${l.animationSpeed}ms ease`}:""),f=u(()=>J/(1-l.thickness/2)),T=u(()=>`${f.value/2} ${f.value/2} ${f.value} ${f.value}`),w=u(()=>be(l.value,l.min,l.max)),U=u(()=>l.max-l.min),x=u(()=>l.thickness/2*f.value),I=u(()=>{const m=(l.max-w.value)/U.value,b=l.rounded===!0&&w.value<l.max&&m<.25?x.value/2*(1-m/.25):0;return Y*m+b});function z({thickness:m,offset:b,color:y,cls:$,rounded:M}){return q("circle",{class:"q-circular-progress__"+$+(y!==void 0?` text-${y}`:""),style:p.value,fill:"transparent",stroke:"currentColor","stroke-width":m,"stroke-dasharray":Se,"stroke-dashoffset":b,"stroke-linecap":M,cx:f.value,cy:f.value,r:A})}return()=>{const m=[];l.centerColor!==void 0&&l.centerColor!=="transparent"&&m.push(q("circle",{class:`q-circular-progress__center text-${l.centerColor}`,fill:"currentColor",r:A-x.value/2,cx:f.value,cy:f.value})),l.trackColor!==void 0&&l.trackColor!=="transparent"&&m.push(z({cls:"track",thickness:x.value,offset:0,color:l.trackColor})),m.push(z({cls:"circle",thickness:x.value,offset:I.value,color:l.color,rounded:l.rounded===!0?"round":void 0}));const b=[q("svg",{class:"q-circular-progress__svg",style:k.value,viewBox:T.value,"aria-hidden":"true"},m)];return l.showValue===!0&&b.push(q("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:l.fontSize}},s.default!==void 0?s.default():[q("div",w.value)])),q("div",{class:`q-circular-progress q-circular-progress--${l.indeterminate===!0?"in":""}determinate`,style:B.value,role:"progressbar","aria-valuemin":l.min,"aria-valuemax":l.max,"aria-valuenow":l.indeterminate===!0?void 0:w.value},de(s.internal,b))}}}),we={class:"row"},qe={class:"col col-12 col-md-8"},Ne={class:"absolute-full flex flex-center"},Qe={class:"row q-mt-sm"},Be={class:"column items-center"},$e={class:"text-overline"},Me={class:"absolute-full flex flex-center"},Ve={class:"absolute-full flex justify-end"},De={class:"absolute-full flex flex-center"},Pe={class:"absolute-full flex justify-end"},ze={class:"text-subtitle1 q-pt-md"},Oe={key:0},Fe={key:1},Re={class:"text-subtitle1 q-pt-md"},Te={key:3},Ue={key:0},We=ce({__name:"ServerStatus",setup(l){const s=me(),Q=O(void 0),B=O(-1),k=O(!1),p=O("/tmp/typesense-data-snapshot");function f(t){return typeof t=="object"}function T(){p.value=`/tmp/typesense-data-snapshot-${new Date().toISOString().replace(/:\d{2}\.\d{3}Z$/,"")}`,k.value=!0}function w(){k.value=!1,p.value="/tmp/typesense-data-snapshot"}function U(){x.value&&(s.createSnapshot(p.value),k.value=!1)}const x=u(()=>p.value&&p.value.length>0);ve(()=>{Q.value=window.setInterval(()=>{s.refreshServerStatus()},2e3)}),fe(()=>{window.clearInterval(Q.value)});const I=u(()=>Object.entries(s.data.metrics).filter(([t])=>/^system_cpu\d+_active_percentage$/.test(t)).map(([t,e])=>{let a=0;const h=t.split("_");return h.length>1&&h[1]&&(a=parseInt(h[1].replace("cpu",""))||0),{node:a,value:parseFloat(e)}}).filter(t=>Number.isFinite(t.value)).sort((t,e)=>t.node-e.node)),z=u(()=>Object.prototype.hasOwnProperty.call(s.data.metrics,"system_cpu_active_percentage")),m=u(()=>{const t=s.data.metrics,e=t?t.system_cpu_active_percentage:void 0,a=typeof e=="number"?e:typeof e=="string"?parseFloat(e):NaN;return isFinite(a)?Math.max(0,Math.min(1,a/100)):0}),b=u(()=>Math.round(m.value*100));function y(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"){const e=Number(t);return Number.isFinite(e)?e:null}return null}const $=u(()=>y(s.data.metrics?.system_memory_used_bytes)),M=u(()=>y(s.data.metrics?.system_memory_total_bytes)),K=u(()=>{const t=$.value,e=M.value;return t!==null&&e!==null&&e>0}),ee=u(()=>{if(!K.value)return 0;const t=$.value/M.value;return Number.isFinite(t)?Math.max(0,Math.min(1,t)):0}),L=u(()=>y(s.data.metrics?.system_disk_used_bytes)),j=u(()=>y(s.data.metrics?.system_disk_total_bytes)),H=u(()=>{const t=L.value,e=j.value;return t!==null&&e!==null&&e>0}),te=u(()=>{if(!H.value)return 0;const t=L.value/j.value;return Number.isFinite(t)?Math.max(0,Math.min(1,t)):0}),ae=u(()=>{const t=y(s.data.metrics?.system_network_received_bytes);return t===null?"—":C(t)}),se=u(()=>{const t=y(s.data.metrics?.system_network_sent_bytes);return t===null?"—":C(t)});function le(t){s.login({apiKey:t.apiKey,node:t.node,forceHomeRedirect:!0})}return(t,e)=>(i(),S(xe,{padding:""},{default:d(()=>[o("div",we,[o("div",qe,[n(F,{flat:"",bordered:"",class:"q-mb-md"},{default:d(()=>[n(D,null,{default:d(()=>[e[5]||(e[5]=o("div",{class:"text-h5"},"System",-1)),e[6]||(e[6]=o("div",{class:"text-subtitle1 q-pt-md"},"CPU",-1)),z.value?(i(),S(E,{key:0,size:"25px",value:m.value,color:"accent"},{default:d(()=>[o("div",Ne,[n(V,{color:"white","text-color":"accent",label:`${b.value}%`},null,8,["label"])])]),_:1},8,["value"])):g("",!0),o("div",Qe,[(i(!0),v(N,null,P(I.value,a=>(i(),v("div",{key:a.node,class:"col-6 col-sm-4 col-md-3 col-lg-2 q-mb-md flex flex-center"},[o("div",Be,[o("span",$e,"CPU "+c(a.node),1),n(_e,{"show-value":"",value:a.value,size:"50px",color:"accent","track-color":"grey-3"},null,8,["value"])])]))),128))]),e[7]||(e[7]=o("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),K.value?(i(),S(E,{key:1,size:"25px",value:ee.value,color:"accent"},{default:d(()=>[o("div",Me,[n(V,{color:"white","text-color":"accent",label:r(C)($.value)},null,8,["label"])]),o("div",Ve,[n(V,{color:"white","text-color":"accent",label:r(C)(M.value)},null,8,["label"])])]),_:1},8,["value"])):g("",!0),e[8]||(e[8]=o("div",{class:"text-subtitle1 q-pt-md"},"Disk",-1)),H.value?(i(),S(E,{key:2,size:"25px",value:te.value,color:"accent"},{default:d(()=>[o("div",De,[n(V,{color:"white","text-color":"accent",label:r(C)(L.value)},null,8,["label"])]),o("div",Pe,[n(V,{color:"white","text-color":"accent",label:r(C)(j.value)},null,8,["label"])])]),_:1},8,["value"])):g("",!0),e[9]||(e[9]=o("div",{class:"text-subtitle1 q-pt-md"},"System Network",-1)),o("div",null," Received: "+c(ae.value)+" Sent: "+c(se.value),1)]),_:1})]),_:1}),n(F,{flat:"",bordered:"",class:"q-mb-md"},{default:d(()=>[n(D,null,{default:d(()=>[e[10]||(e[10]=o("div",{class:"text-h5 q-mb-md"},"Operations",-1)),e[11]||(e[11]=o("div",{class:"text-subtitle1 q-pt-md"},"Cache",-1)),e[12]||(e[12]=o("p",null," Responses of search requests that are sent with use_cache parameter are cached in a LRU cache. ",-1)),n(_,{label:"Clear Search Cache",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:r(s).clearCache},null,8,["onClick"]),e[13]||(e[13]=o("div",{class:"text-subtitle1 q-pt-md"},"Slow Request Log",-1)),e[14]||(e[14]=o("p",null,"Slow requests are logged to the primary log file, with the prefix SLOW REQUEST",-1)),n(X,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=a=>B.value=a),modelModifiers:{number:!0},outlined:"",label:"Threshold (ms)",type:"number",hint:"Enable logging of requests that take over a defined threshold of time. (-1 to disable)"},{after:d(()=>[n(_,{unelevated:"",label:"set",color:"accent",size:"md",padding:"sm lg",onClick:e[0]||(e[0]=a=>r(s).slowQueryThreshold(B.value))})]),_:1},8,["modelValue"]),e[15]||(e[15]=o("div",{class:"text-subtitle1 q-pt-md"},"Compacting the on-disk database",-1)),e[16]||(e[16]=o("p",null,"Recommended to run it during off-peak hours.",-1)),n(_,{label:"Compact Database",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:r(s).operationCompactDB},null,8,["onClick"]),e[17]||(e[17]=o("div",{class:"text-subtitle1 q-pt-md"},"Create Snapshot",-1)),e[18]||(e[18]=o("p",null," Creates a point-in-time snapshot of the node's state and data for backup purposes. ",-1)),n(_,{label:"Create Snapshot",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:e[2]||(e[2]=a=>T())})]),_:1})]),_:1})]),n(F,{flat:"",bordered:"",class:"col-12 col-md-3 offset-md-1 q-mb-md"},{default:d(()=>[n(D,null,{default:d(()=>[e[21]||(e[21]=o("div",{class:"text-h5"},"Typesense",-1)),o("div",ze,[e[19]||(e[19]=R(" Node ",-1)),n(oe,{health:r(s).data.health},null,8,["health"])]),o("div",null,"Protocol: "+c(r(s).loginData?.node.protocol),1),o("div",null,"Host: "+c(r(s).loginData?.node.host),1),o("div",null,"Port: "+c(r(s).loginData?.node.port),1),r(s).data.debug.version?(i(),v("div",Oe,"Version: "+c(r(s).data.debug.version),1)):g("",!0),Object.hasOwnProperty.call(r(s).data.debug,"state")?(i(),v("div",Fe," Role: "+c(r(s).data.debug.state===1?"Leader":"Follower"),1)):g("",!0),r(s).currentClusterTag?(i(),v(N,{key:2},[o("div",Re,"Cluster: "+c(r(s).currentClusterTag),1),n(ke,{dense:"",separator:"",class:"q-mt-xs"},{default:d(()=>[(i(!0),v(N,null,P(r(s).clusterMembersForCurrent,(a,h)=>(i(),S(he,{key:h,clickable:"",disable:r(s).isCurrent(a),onClick:W=>le(a)},{default:d(()=>[n(Z,null,{default:d(()=>[R(c(a.node.protocol)+"://"+c(a.node.host)+":"+c(a.node.port),1)]),_:2},1024),n(Z,{side:""},{default:d(()=>[r(s).isCurrent(a)?(i(),S(ge,{key:0,color:"positive","text-color":"white",dense:"",size:"sm"},{default:d(()=>[...e[20]||(e[20]=[R(" Current ",-1)])]),_:1})):(i(),S(_,{key:1,flat:"",dense:"",size:"sm",label:"Connect"}))]),_:2},1024)]),_:2},1032,["disable","onClick"]))),128))]),_:1})],64)):g("",!0),e[22]||(e[22]=o("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),(i(!0),v(N,null,P(Object.keys(r(s).data.metrics).filter(a=>a.includes("typesense")),a=>(i(),v("div",{key:a},c(a.split("_")[2])+" : "+c(a.includes("bytes")?r(C)(parseInt(r(s).data.metrics[a],10)):r(s).data.metrics[a]),1))),128)),e[23]||(e[23]=o("div",{class:"text-subtitle1 q-pt-md"},"Stats",-1)),r(s).data.features.stats?g("",!0):(i(),v("div",Te,"Stats are not enabled on this node.")),(i(!0),v(N,null,P(r(s).data.stats,(a,h)=>(i(),v("div",{key:h},[f(a)?(i(),v("div",Ue,[R(c(h)+" ",1),(i(!0),v(N,null,P(a,(W,G)=>(i(),v("div",{key:G},c(G)+" : "+c(W),1))),128))])):g("",!0)]))),128))]),_:1})]),_:1})]),n(pe,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=a=>k.value=a),persistent:""},{default:d(()=>[n(F,{style:{"min-width":"400px"}},{default:d(()=>[n(D,null,{default:d(()=>[...e[24]||(e[24]=[o("div",{class:"text-h6"},"Create Snapshot",-1),o("div",{class:"text-subtitle2 text-grey-7 q-mt-sm"}," Enter the directory path where the snapshot should be saved on the server. ",-1)])]),_:1}),n(D,{class:"q-pt-none"},{default:d(()=>[n(X,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a),outlined:"",label:"Snapshot Path",hint:"Example: /tmp/typesense-data-snapshot",rules:[a=>a&&a.length>0||"Snapshot path is required"]},null,8,["modelValue","rules"])]),_:1}),n(ye,{align:"right",class:"text-primary"},{default:d(()=>[n(_,{flat:"",label:"Cancel",onClick:w}),n(_,{flat:"",label:"Create Snapshot",color:"accent",disable:!x.value,onClick:U},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{We as default};
