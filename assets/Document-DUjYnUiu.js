import{K as N,u as V,H as D,f as Q,w as b,L as p,M as n,N as a,a1 as l,O as d,Y as C,R as u,Q as S,X as m,S as g,W as y,a4 as c,a5 as j,a6 as B,ab as O}from"./index-CBEB88vI.js";import{Q as v}from"./QBanner-BhRyK5_R.js";import{c as T}from"./QSelect-wCO4Ghz2.js";import{Q as A}from"./QPage-BTm-UIH3.js";import{M as F}from"./MonacoEditor-r6QeIA4a.js";import{u as J}from"./use-quasar-CH1PUBwU.js";import"./format-BvkBI9bc.js";import"./QResizeObserver-gsU3Eslk.js";const U={class:"row justify-between q-mb-md"},z={class:"text-h5"},I={key:0},P={class:"row q-mb-md bg-primary text-white justify-between"},$={class:"row col-auto"},q={key:0},M={key:1},ee=N({__name:"Document",setup(L){const i=J(),r=V(),e=D({jsonError:null,documents:[],results:[],action:"upsert"}),x=["create","upsert","update"],E={create:"Create a new document. Fails if id exists.",upsert:"Create a new document or update an existing document.",update:"Update an existing document. Partial document allowed."},f=Q({get:()=>JSON.stringify(e.documents,null,2),set:o=>{try{e.documents=JSON.parse(o),e.jsonError=null}catch(t){e.jsonError=t.message}}});b(()=>r.currentCollection,()=>{e.documents=[],_()},{immediate:!0}),b(()=>r.documentsToEdit,()=>{r.documentsToEdit&&r.documentsToEdit.length>0&&(e.documents=r.documentsToEdit||[],e.action="upsert",r.setDocumentsToEdit([]))},{immediate:!0});async function k(){e.results=[];try{i.loading.show({message:"Uploading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"});let o=await r.api?.importFile(r.currentCollection?.name,e.action);Array.isArray(o)||(o=[{error:o}]),e.results=o}catch(o){e.results=[{error:o.message}]}i.loading.hide()}async function h(){e.results=[];try{i.loading.show({message:"Uploading. Please wait...",boxClass:"bg-grey-2 text-grey-9",spinnerColor:"primary"}),e.results=await r.importDocuments({action:e.action,documents:JSON.parse(JSON.stringify(e.documents))})}catch(o){e.results=[{error:o.message}]}i.loading.hide()}function _(){let o={};r.currentCollection&&r.currentCollection.fields&&(o=r.currentCollection.fields.reduce((t,s)=>(t[s.name]=s.type.includes("[]")?[]:s.type.includes("string")?"":s.type.includes("bool")?!1:0,t),{})),e.documents.push(o)}return(o,t)=>(n(),p(A,{padding:"",class:"column"},{default:a(()=>[l("div",U,[l("div",z,[d(S,{size:"md",name:"sym_s_library_add"}),u(" Add Documents to "+m(g(r).currentCollection?.name),1)]),d(y,{unelevated:"",disable:!g(i).platform.is.electron,icon:"sym_s_attach_file",onClick:t[0]||(t[0]=s=>k())},{default:a(()=>[t[5]||(t[5]=u(" Import from file ")),g(i).platform.is.electron?C("",!0):(n(),c("span",I," (only desktop version)"))]),_:1,__:[5]},8,["disable"])]),d(F,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),style:{"min-height":"200px"}},null,8,["modelValue"]),e.jsonError?(n(),p(v,{key:0,"inline-actions":"",class:"text-white bg-red"},{default:a(()=>[u(" Invalid Format: "+m(e.jsonError),1)]),_:1})):C("",!0),l("div",P,[d(y,{unelevated:"",size:"md",padding:"sm lg",color:"primary",onClick:t[2]||(t[2]=s=>_())},{default:a(()=>t[6]||(t[6]=[u("Add empty Document")])),_:1,__:[6]}),l("div",$,[d(T,{modelValue:e.action,"onUpdate:modelValue":t[3]||(t[3]=s=>e.action=s),dark:"","bottom-slots":"",label:"Action mode",filled:"",style:{width:"300px"},options:x},{hint:a(()=>[l("div",null,m(E[e.action]),1)]),_:1},8,["modelValue"]),d(y,{unelevated:"",size:"md",padding:"sm xl",color:"primary",disable:!!e.jsonError,onClick:t[4]||(t[4]=s=>h())},{default:a(()=>t[7]||(t[7]=[u("Import")])),_:1,__:[7]},8,["disable"])])]),l("div",null,[(n(!0),c(j,null,B(e.results,(s,w)=>(n(),p(v,{key:w,class:O(["text-white",{"bg-green":s.success,"bg-red":s.error}])},{default:a(()=>[u(m(w)+": ",1),s.success?(n(),c("span",q,m(s.success),1)):(n(),c("span",M,m(s.error),1))]),_:2},1032,["class"]))),128))])]),_:1}))}});export{ee as default};
