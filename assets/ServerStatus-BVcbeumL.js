import{Q as I,p as x,_ as W}from"./HealthTag.vue_vue_type_script_setup_true_lang-VBEdJhcw.js";import{Q as U}from"./QLinearProgress-CAcYNZiO.js";import{a0 as G,e as X,i as Z,a1 as J,f as v,h as C,a2 as Y,K as ee,u as te,r as N,A as ae,o as se,U as $,M as i,O as n,R as o,N as r,a3 as O,a4 as V,V as S,L as m,a5 as w,a6 as P,$ as d,T as s,S as k,a7 as E,X as D,a8 as le,a9 as oe}from"./index-C-yUslDh.js";import{b as re,a as ne,Q as A}from"./QItem-GEGTCWs8.js";import{Q as ie}from"./QChip-DEvn5zOm.js";import{Q as de}from"./QList-DZek21Vd.js";import{Q as ue}from"./QPage-DZDjStMx.js";const ce={...G,min:{type:Number,default:0},max:{type:Number,default:100},color:String,centerColor:String,trackColor:String,fontSize:String,rounded:Boolean,thickness:{type:Number,default:.2,validator:l=>l>=0&&l<=1},angle:{type:Number,default:0},showValue:Boolean,reverse:Boolean,instantFeedback:Boolean},j=50,K=2*j,H=K*Math.PI,me=Math.round(H*1e3)/1e3,ve=X({name:"QCircularProgress",props:{...ce,value:{type:Number,default:0},animationSpeed:{type:[String,Number],default:600},indeterminate:Boolean},setup(l,{slots:t}){const{proxy:{$q:q}}=Z(),Q=J(l),h=v(()=>{const u=(q.lang.rtl===!0?-1:1)*l.angle;return{transform:l.reverse!==(q.lang.rtl===!0)?`scale3d(-1, 1, 1) rotate3d(0, 0, 1, ${-90-u}deg)`:`rotate3d(0, 0, 1, ${u-90}deg)`}}),p=v(()=>l.instantFeedback!==!0&&l.indeterminate!==!0?{transition:`stroke-dashoffset ${l.animationSpeed}ms ease 0s, stroke ${l.animationSpeed}ms ease`}:""),f=v(()=>K/(1-l.thickness/2)),M=v(()=>`${f.value/2} ${f.value/2} ${f.value} ${f.value}`),_=v(()=>re(l.value,l.min,l.max)),R=v(()=>l.max-l.min),g=v(()=>l.thickness/2*f.value),T=v(()=>{const u=(l.max-_.value)/R.value,y=l.rounded===!0&&_.value<l.max&&u<.25?g.value/2*(1-u/.25):0;return H*u+y});function z({thickness:u,offset:y,color:B,cls:c,rounded:e}){return C("circle",{class:"q-circular-progress__"+c+(B!==void 0?` text-${B}`:""),style:p.value,fill:"transparent",stroke:"currentColor","stroke-width":u,"stroke-dasharray":me,"stroke-dashoffset":y,"stroke-linecap":e,cx:f.value,cy:f.value,r:j})}return()=>{const u=[];l.centerColor!==void 0&&l.centerColor!=="transparent"&&u.push(C("circle",{class:`q-circular-progress__center text-${l.centerColor}`,fill:"currentColor",r:j-g.value/2,cx:f.value,cy:f.value})),l.trackColor!==void 0&&l.trackColor!=="transparent"&&u.push(z({cls:"track",thickness:g.value,offset:0,color:l.trackColor})),u.push(z({cls:"circle",thickness:g.value,offset:T.value,color:l.color,rounded:l.rounded===!0?"round":void 0}));const y=[C("svg",{class:"q-circular-progress__svg",style:h.value,viewBox:M.value,"aria-hidden":"true"},u)];return l.showValue===!0&&y.push(C("div",{class:"q-circular-progress__text absolute-full row flex-center content-center",style:{fontSize:l.fontSize}},t.default!==void 0?t.default():[C("div",_.value)])),C("div",{class:`q-circular-progress q-circular-progress--${l.indeterminate===!0?"in":""}determinate`,style:Q.value,role:"progressbar","aria-valuemin":l.min,"aria-valuemax":l.max,"aria-valuenow":l.indeterminate===!0?void 0:_.value},Y(t.internal,y))}}}),fe={class:"row"},pe={class:"col col-12 col-md-8"},ye={class:"absolute-full flex flex-center"},be={class:"row q-mt-sm"},he={class:"column items-center"},ge={class:"text-overline"},xe={class:"absolute-full flex flex-center"},ke={class:"absolute-full flex justify-end"},_e={class:"absolute-full flex flex-center"},Ce={class:"absolute-full flex justify-end"},Se={class:"text-subtitle1 q-pt-md"},we={key:0},qe={key:1},Qe={class:"text-subtitle1 q-pt-md"},Ie={key:3},$e={key:0},Me=ee({__name:"ServerStatus",setup(l){const t=te(),q=N(void 0),Q=N(-1),h=N(!1),p=N("/tmp/typesense-data-snapshot");function f(c){return typeof c=="object"}function M(){p.value=`/tmp/typesense-data-snapshot-${new Date().toISOString().replace(/:\d{2}\.\d{3}Z$/,"")}`,h.value=!0}function _(){h.value=!1,p.value="/tmp/typesense-data-snapshot"}function R(){g.value&&(t.createSnapshot(p.value),h.value=!1)}const g=v(()=>p.value&&p.value.length>0);ae(()=>{q.value=window.setInterval(()=>{t.refreshServerStatus()},2e3)}),se(()=>{window.clearInterval(q.value)});const T=v(()=>Object.entries(t.data.metrics).filter(([c])=>/^system_cpu\d+_active_percentage$/.test(c)).map(([c,e])=>{let a=0;const b=c.split("_");return b.length>1&&b[1]&&(a=parseInt(b[1].replace("cpu",""))||0),{node:a,value:parseFloat(e)}}).sort((c,e)=>c.node-e.node)),z=v(()=>Object.prototype.hasOwnProperty.call(t.data.metrics,"system_cpu_active_percentage")),u=v(()=>{const c=t.data.metrics,e=c?c.system_cpu_active_percentage:void 0,a=typeof e=="number"?e:typeof e=="string"?parseFloat(e):NaN;return isFinite(a)?Math.max(0,Math.min(1,a/100)):0}),y=v(()=>Math.round(u.value*100));function B(c){t.login({apiKey:c.apiKey,node:c.node,forceHomeRedirect:!0})}return(c,e)=>(i(),$(ue,{padding:""},{default:n(()=>[o("div",fe,[o("div",pe,[r(O,{flat:"",bordered:"",class:"q-mb-md"},{default:n(()=>[r(V,null,{default:n(()=>[e[5]||(e[5]=o("div",{class:"text-h5"},"System",-1)),e[6]||(e[6]=o("div",{class:"text-subtitle1 q-pt-md"},"CPU",-1)),z.value?(i(),$(U,{key:0,size:"25px",value:u.value,color:"accent"},{default:n(()=>[o("div",ye,[r(I,{color:"white","text-color":"accent",label:`${y.value}%`},null,8,["label"])])]),_:1},8,["value"])):S("",!0),o("div",be,[(i(!0),m(w,null,P(T.value,a=>(i(),m("div",{key:a.node,class:"col-6 col-sm-4 col-md-3 col-lg-2 q-mb-md flex flex-center"},[o("div",he,[o("span",ge,"CPU "+d(a.node),1),r(ve,{"show-value":"",value:a.value,size:"50px",color:"accent","track-color":"grey-3"},null,8,["value"])])]))),128))]),e[7]||(e[7]=o("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),r(U,{size:"25px",value:parseInt(s(t).data.metrics.system_memory_used_bytes,10)/parseInt(s(t).data.metrics.system_memory_total_bytes,10),color:"accent"},{default:n(()=>[o("div",xe,[r(I,{color:"white","text-color":"accent",label:s(x)(parseInt(s(t).data.metrics.system_memory_used_bytes,10))},null,8,["label"])]),o("div",ke,[r(I,{color:"white","text-color":"accent",label:s(x)(parseInt(s(t).data.metrics.system_memory_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),e[8]||(e[8]=o("div",{class:"text-subtitle1 q-pt-md"},"Disk",-1)),r(U,{size:"25px",value:parseInt(s(t).data.metrics.system_disk_used_bytes,10)/parseInt(s(t).data.metrics.system_disk_total_bytes,10),color:"accent"},{default:n(()=>[o("div",_e,[r(I,{color:"white","text-color":"accent",label:s(x)(parseInt(s(t).data.metrics.system_disk_used_bytes,10))},null,8,["label"])]),o("div",Ce,[r(I,{color:"white","text-color":"accent",label:s(x)(parseInt(s(t).data.metrics.system_disk_total_bytes,10))},null,8,["label"])])]),_:1},8,["value"]),e[9]||(e[9]=o("div",{class:"text-subtitle1 q-pt-md"},"System Network",-1)),o("div",null," Received: "+d(s(x)(parseInt(s(t).data.metrics.system_network_received_bytes,10)))+" Sent: "+d(s(x)(parseInt(s(t).data.metrics.system_network_sent_bytes,10))),1)]),_:1})]),_:1}),r(O,{flat:"",bordered:"",class:"q-mb-md"},{default:n(()=>[r(V,null,{default:n(()=>[e[10]||(e[10]=o("div",{class:"text-h5 q-mb-md"},"Operations",-1)),e[11]||(e[11]=o("div",{class:"text-subtitle1 q-pt-md"},"Cache",-1)),e[12]||(e[12]=o("p",null," Responses of search requests that are sent with use_cache parameter are cached in a LRU cache. ",-1)),r(k,{label:"Clear Search Cache",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:s(t).clearCache},null,8,["onClick"]),e[13]||(e[13]=o("div",{class:"text-subtitle1 q-pt-md"},"Slow Request Log",-1)),e[14]||(e[14]=o("p",null,"Slow requests are logged to the primary log file, with the prefix SLOW REQUEST",-1)),r(E,{modelValue:Q.value,"onUpdate:modelValue":e[1]||(e[1]=a=>Q.value=a),modelModifiers:{number:!0},outlined:"",label:"Threshold (ms)",type:"number",hint:"Enable logging of requests that take over a defined threshold of time. (-1 to disable)"},{after:n(()=>[r(k,{unelevated:"",label:"set",color:"accent",size:"md",padding:"sm lg",onClick:e[0]||(e[0]=a=>s(t).slowQueryThreshold(Q.value))})]),_:1},8,["modelValue"]),e[15]||(e[15]=o("div",{class:"text-subtitle1 q-pt-md"},"Compacting the on-disk database",-1)),e[16]||(e[16]=o("p",null,"Recommended to run it during off-peak hours.",-1)),r(k,{label:"Compact Database",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:s(t).operationCompactDB},null,8,["onClick"]),e[17]||(e[17]=o("div",{class:"text-subtitle1 q-pt-md"},"Create Snapshot",-1)),e[18]||(e[18]=o("p",null," Creates a point-in-time snapshot of the node's state and data for backup purposes. ",-1)),r(k,{label:"Create Snapshot",color:"accent",unelevated:"",size:"md",padding:"sm lg",onClick:e[2]||(e[2]=a=>M())})]),_:1})]),_:1})]),r(O,{flat:"",bordered:"",class:"col-12 col-md-3 offset-md-1 q-mb-md"},{default:n(()=>[r(V,null,{default:n(()=>[e[21]||(e[21]=o("div",{class:"text-h5"},"Typesense",-1)),o("div",Se,[e[19]||(e[19]=D(" Node ",-1)),r(W,{health:s(t).data.health},null,8,["health"])]),o("div",null,"Protocol: "+d(s(t).loginData?.node.protocol),1),o("div",null,"Host: "+d(s(t).loginData?.node.host),1),o("div",null,"Port: "+d(s(t).loginData?.node.port),1),s(t).data.debug.version?(i(),m("div",we,"Version: "+d(s(t).data.debug.version),1)):S("",!0),Object.hasOwnProperty.call(s(t).data.debug,"state")?(i(),m("div",qe," Role: "+d(s(t).data.debug.state===1?"Leader":"Follower"),1)):S("",!0),s(t).currentClusterTag?(i(),m(w,{key:2},[o("div",Qe,"Cluster: "+d(s(t).currentClusterTag),1),r(de,{dense:"",separator:"",class:"q-mt-xs"},{default:n(()=>[(i(!0),m(w,null,P(s(t).clusterMembersForCurrent,(a,b)=>(i(),$(ne,{key:b,clickable:"",disable:s(t).isCurrent(a),onClick:F=>B(a)},{default:n(()=>[r(A,null,{default:n(()=>[D(d(a.node.protocol)+"://"+d(a.node.host)+":"+d(a.node.port),1)]),_:2},1024),r(A,{side:""},{default:n(()=>[s(t).isCurrent(a)?(i(),$(ie,{key:0,color:"positive","text-color":"white",dense:"",size:"sm"},{default:n(()=>[...e[20]||(e[20]=[D(" Current ",-1)])]),_:1})):(i(),$(k,{key:1,flat:"",dense:"",size:"sm",label:"Connect"}))]),_:2},1024)]),_:2},1032,["disable","onClick"]))),128))]),_:1})],64)):S("",!0),e[22]||(e[22]=o("div",{class:"text-subtitle1 q-pt-md"},"Memory",-1)),(i(!0),m(w,null,P(Object.keys(s(t).data.metrics).filter(a=>a.includes("typesense")),a=>(i(),m("div",{key:a},d(a.split("_")[2])+" : "+d(a.includes("bytes")?s(x)(parseInt(s(t).data.metrics[a],10)):s(t).data.metrics[a]),1))),128)),e[23]||(e[23]=o("div",{class:"text-subtitle1 q-pt-md"},"Stats",-1)),s(t).data.features.stats?S("",!0):(i(),m("div",Ie,"Stats are not enabled on this node.")),(i(!0),m(w,null,P(s(t).data.stats,(a,b)=>(i(),m("div",{key:b},[f(a)?(i(),m("div",$e,[D(d(b)+" ",1),(i(!0),m(w,null,P(a,(F,L)=>(i(),m("div",{key:L},d(L)+" : "+d(F),1))),128))])):S("",!0)]))),128))]),_:1})]),_:1})]),r(le,{modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),persistent:""},{default:n(()=>[r(O,{style:{"min-width":"400px"}},{default:n(()=>[r(V,null,{default:n(()=>[...e[24]||(e[24]=[o("div",{class:"text-h6"},"Create Snapshot",-1),o("div",{class:"text-subtitle2 text-grey-7 q-mt-sm"}," Enter the directory path where the snapshot should be saved on the server. ",-1)])]),_:1}),r(V,{class:"q-pt-none"},{default:n(()=>[r(E,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=a=>p.value=a),outlined:"",label:"Snapshot Path",hint:"Example: /tmp/typesense-data-snapshot",rules:[a=>a&&a.length>0||"Snapshot path is required"]},null,8,["modelValue","rules"])]),_:1}),r(oe,{align:"right",class:"text-primary"},{default:n(()=>[r(k,{flat:"",label:"Cancel",onClick:_}),r(k,{flat:"",label:"Create Snapshot",color:"accent",disable:!g.value,onClick:R},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Me as default};
