"use strict";(globalThis["webpackChunktypesense_dashboard"]=globalThis["webpackChunktypesense_dashboard"]||[]).push([[40],{68040:(e,l,t)=>{t.r(l),t.d(l,{default:()=>q});var a=t(61758),n=t(58790);const s={class:"text-h6"};function o(e,l,t,o,i,d){const c=(0,a.g2)("q-input"),r=(0,a.g2)("q-card-section"),u=(0,a.g2)("q-select"),m=(0,a.g2)("q-btn"),p=(0,a.g2)("q-card-actions"),b=(0,a.g2)("q-card"),f=(0,a.g2)("q-expansion-item"),g=(0,a.g2)("q-icon"),h=(0,a.g2)("q-td"),y=(0,a.g2)("q-table"),_=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(_,{padding:""},{default:(0,a.k6)((()=>[(0,a.bF)(f,{"expand-separator":"",icon:"sym_s_add_circle","expand-icon":"sym_s_unfold_more","expanded-icon":"sym_s_unfold_less",label:(e.isUpdate?"Update":"Add")+" Analytics Rule","header-class":"bg-primary text-white",modelValue:e.expanded,"onUpdate:modelValue":l[6]||(l[6]=l=>e.expanded=l)},{default:(0,a.k6)((()=>[(0,a.bF)(b,{class:"bg-surface column"},{default:(0,a.k6)((()=>[(0,a.bF)(r,{class:"row q-col-gutter-md"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{class:"col-12 col-sm-6",modelValue:e.rule.name,"onUpdate:modelValue":l[0]||(l[0]=l=>e.rule.name=l),label:"Rule Name",filled:"",rules:[e=>!!e||"Field is required"]},null,8,["modelValue","rules"]),(0,a.bF)(c,{class:"col-12 col-sm-6",modelValue:e.rule.type,"onUpdate:modelValue":l[1]||(l[1]=l=>e.rule.type=l),label:"Rule Type",filled:"",rules:[e=>!!e||"Field is required"]},null,8,["modelValue","rules"])])),_:1}),(0,a.bF)(r,{class:"row q-col-gutter-md"},{default:(0,a.k6)((()=>[(0,a.bF)(u,{class:"col-12 col-sm-6",modelValue:e.rule.params.source.collections,"onUpdate:modelValue":l[2]||(l[2]=l=>e.rule.params.source.collections=l),label:"Source Collection(s)",filled:"",options:e.collectionNames,multiple:"",hint:"Track searches sent to these collections"},null,8,["modelValue","options"]),(0,a.bF)(u,{class:"col-12 col-sm-6",modelValue:e.rule.params.destination.collection,"onUpdate:modelValue":l[3]||(l[3]=l=>e.rule.params.destination.collection=l),label:"Destination Collection",filled:"",options:e.collectionNames},null,8,["modelValue","options"])])),_:1}),(0,a.bF)(r,{class:"row q-col-gutter-md"},{default:(0,a.k6)((()=>[(0,a.bF)(c,{class:"col-12 col-sm-6",modelValue:e.rule.params.limit,"onUpdate:modelValue":l[4]||(l[4]=l=>e.rule.params.limit=l),label:"Limit",filled:"",type:"number",min:"0"},null,8,["modelValue"])])),_:1}),(0,a.bF)(p,{align:"right",class:"bg-primary"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{size:"md",padding:"sm lg",unelevated:"",color:"primary",onClick:l[5]||(l[5]=l=>e.createRule())},{default:(0,a.k6)((()=>[(0,a.eW)((0,n.v_)(e.isUpdate?"Update":"Add")+" Rule",1)])),_:1})])),_:1})])),_:1})])),_:1},8,["label","modelValue"]),(0,a.bF)(y,{class:"q-mt-md",title:"Analytics Rules",flat:"",bordered:"",filter:e.filter,rows:e.$store.state.node.data.analyticsRules,columns:e.columns,"row-key":"name",pagination:{rowsPerPage:50,sortBy:"name"}},{"top-left":(0,a.k6)((()=>[(0,a.Lk)("div",s,[(0,a.bF)(g,{size:"md",name:"sym_s_query_stats"}),l[8]||(l[8]=(0,a.eW)(" Analytics Rules "))])])),"top-right":(0,a.k6)((()=>[(0,a.bF)(c,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[7]||(l[7]=l=>e.filter=l),placeholder:"Search"},{append:(0,a.k6)((()=>[(0,a.bF)(g,{name:"sym_s_search"})])),_:1},8,["modelValue"])])),"body-cell-actions":(0,a.k6)((l=>[(0,a.bF)(h,{class:"text-right"},{default:(0,a.k6)((()=>[(0,a.bF)(m,{flat:"",onClick:t=>e.editRule(l.row),icon:"sym_s_edit",title:"Edit"},null,8,["onClick"]),(0,a.bF)(m,{flat:"",color:"negative",onClick:t=>e.deleteRule(l.row.name),icon:"sym_s_delete_forever",title:"Delete"},null,8,["onClick"])])),_:2},1024)])),_:1},8,["filter","rows","columns"])])),_:1})}var i=function(e,l,t,a){function n(e){return e instanceof t?e:new t((function(l){l(e)}))}return new(t||(t=Promise))((function(t,s){function o(e){try{d(a.next(e))}catch(l){s(l)}}function i(e){try{d(a["throw"](e))}catch(l){s(l)}}function d(e){e.done?t(e.value):n(e.value).then(o,i)}d((a=a.apply(e,l||[])).next())}))};function d(){return{name:"",type:"popular_queries",params:{source:{collections:[]},destination:{collection:""},limit:100}}}const c=(0,a.pM)({name:"AnalyticsRules",data(){return{rule:d(),expanded:0===this.$store.state.node.data.analyticsRules.length,filter:"",columns:[{label:"Rule Name",name:"name",field:"name",align:"left",sortable:!0},{label:"Rule Type",name:"type",field:"type",align:"left",sortable:!0},{label:"Source Collection(s)",name:"source",field:e=>e.params.source.collections.join(", "),align:"left",sortable:!0},{label:"Destination Collection",name:"destination",field:e=>e.params.destination.collection,align:"left",sortable:!0},{label:"Limit",name:"limit",field:e=>e.params.limit,align:"right",sortable:!0},{label:"Actions",name:"actions",align:"right"}]}},mounted(){this.$store.dispatch("node/getAnalyticsRules")},computed:{collectionNames(){return this.$store.state.node.data.collections.map((e=>e.name))},isUpdate(){return this.$store.state.node.data.analyticsRules.map((e=>e.name)).includes(this.rule.name)}},methods:{createRule(){return i(this,void 0,void 0,(function*(){yield this.$store.dispatch("node/createAnalyticsRule",this.rule),this.expanded=!1,this.rule=d()}))},editRule(e){this.rule=JSON.parse(JSON.stringify(e)),this.expanded=!0},deleteRule(e){this.$q.dialog({title:"Confirm",message:`Delete analytics rule ${e}?`,cancel:!0,persistent:!0}).onOk((()=>{this.$store.dispatch("node/deleteAnalyticsRule",e)}))}}});var r=t(12807),u=t(77716),m=t(9459),p=t(23316),b=t(44189),f=t(39270),g=t(75848),h=t(62669),y=t(1693),_=t(39942),k=t(50492),A=t(45262),F=t(98582),R=t.n(F);const V=(0,r.A)(c,[["render",o]]),q=V;R()(c,"components",{QPage:u.A,QExpansionItem:m.A,QCard:p.A,QCardSection:b.A,QInput:f.A,QSelect:g.A,QCardActions:h.A,QBtn:y.A,QTable:_.A,QIcon:k.A,QTd:A.A})}}]);